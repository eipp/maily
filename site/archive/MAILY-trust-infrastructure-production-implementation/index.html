<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation for the Maily AI-Powered Email Campaign Platform"><meta name=author content="Maily Team"><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.5"><title>MAILY Trust Infrastructure - Production Implementation Plan - Maily Documentation</title><link rel=stylesheet href=../../assets/stylesheets/main.8608ea7d.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#maily-trust-infrastructure-production-implementation-plan class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Maily Documentation" class="md-header__button md-logo" aria-label="Maily Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Maily Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> MAILY Trust Infrastructure - Production Implementation Plan </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/yourusername/maily title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../core-guide/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../architecture-overview.md class=md-tabs__link> Platform Documentation </a> </li> <li class=md-tabs__item> <a href=../../ai-handbook/ class=md-tabs__link> Features </a> </li> <li class=md-tabs__item> <a href=../../frontend-apps/ class=md-tabs__link> Applications </a> </li> <li class=md-tabs__item> <a href=../../api-reference/ class=md-tabs__link> Technical Reference </a> </li> <li class=md-tabs__item> <a href=../../contributing-guide.md class=md-tabs__link> Development </a> </li> <li class=md-tabs__item> <a href=../../infrastructure-implementation-summary.md class=md-tabs__link> Resources </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Maily Documentation" class="md-nav__button md-logo" aria-label="Maily Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Maily Documentation </label> <div class=md-nav__source> <a href=https://github.com/yourusername/maily title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex=0> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../core-guide/ class=md-nav__link> <span class=md-ellipsis> Core Guide </span> </a> </li> <li class=md-nav__item> <a href=../../glossary-and-faq/ class=md-nav__link> <span class=md-ellipsis> Glossary and FAQ </span> </a> </li> <li class=md-nav__item> <a href=../../quick-start.md class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Platform Documentation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Platform Documentation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../architecture-overview.md class=md-nav__link> <span class=md-ellipsis> Architecture Overview </span> </a> </li> <li class=md-nav__item> <a href=../../tech-stack.md class=md-nav__link> <span class=md-ellipsis> Tech Stack </span> </a> </li> <li class=md-nav__item> <a href=../../enhancement-plan/ class=md-nav__link> <span class=md-ellipsis> Enhancement Plan </span> </a> </li> <li class=md-nav__item> <a href=../../modernization-roadmap/ class=md-nav__link> <span class=md-ellipsis> Modernization Roadmap </span> </a> </li> <li class=md-nav__item> <a href=../../integration-guide/ class=md-nav__link> <span class=md-ellipsis> Integration Guide </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Features </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ai-handbook/ class=md-nav__link> <span class=md-ellipsis> AI Handbook </span> </a> </li> <li class=md-nav__item> <a href=../../security-compliance-handbook/ class=md-nav__link> <span class=md-ellipsis> Security & Compliance </span> </a> </li> <li class=md-nav__item> <a href=../../analytics-capabilities.md class=md-nav__link> <span class=md-ellipsis> Analytics Capabilities </span> </a> </li> <li class=md-nav__item> <a href=../../email-features-handbook.md class=md-nav__link> <span class=md-ellipsis> Email Features </span> </a> </li> <li class=md-nav__item> <a href=../../internationalization-guide.md class=md-nav__link> <span class=md-ellipsis> Internationalization </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Applications </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Applications </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../frontend-apps/ class=md-nav__link> <span class=md-ellipsis> Frontend Applications </span> </a> </li> <li class=md-nav__item> <a href=../../api-services.md class=md-nav__link> <span class=md-ellipsis> API Services </span> </a> </li> <li class=md-nav__item> <a href=../../worker-services.md class=md-nav__link> <span class=md-ellipsis> Worker Services </span> </a> </li> <li class=md-nav__item> <a href=../../app-components/ class=md-nav__link> <span class=md-ellipsis> App Components </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Technical Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Technical Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../api-reference/ class=md-nav__link> <span class=md-ellipsis> API Reference </span> </a> </li> <li class=md-nav__item> <a href=../../database-schema.md class=md-nav__link> <span class=md-ellipsis> Database Schema </span> </a> </li> <li class=md-nav__item> <a href=../../enhancement-tools-reference/ class=md-nav__link> <span class=md-ellipsis> Enhancement Tools </span> </a> </li> <li class=md-nav__item> <a href=../../configuration-guide.md class=md-nav__link> <span class=md-ellipsis> Configuration Guide </span> </a> </li> <li class=md-nav__item> <a href=../../error-codes.md class=md-nav__link> <span class=md-ellipsis> Error Codes </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Development </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Development </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../contributing-guide.md class=md-nav__link> <span class=md-ellipsis> Contributing Guide </span> </a> </li> <li class=md-nav__item> <a href=../../testing-strategy.md class=md-nav__link> <span class=md-ellipsis> Testing Strategy </span> </a> </li> <li class=md-nav__item> <a href=../../code-style-guide.md class=md-nav__link> <span class=md-ellipsis> Code Style Guide </span> </a> </li> <li class=md-nav__item> <a href=../../ci-cd-pipeline.md class=md-nav__link> <span class=md-ellipsis> CI/CD Pipeline </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Resources </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Resources </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_1> <label class=md-nav__link for=__nav_7_1 id=__nav_7_1_label tabindex=0> <span class=md-ellipsis> Implementation Summaries </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_1_label aria-expanded=false> <label class=md-nav__title for=__nav_7_1> <span class="md-nav__icon md-icon"></span> Implementation Summaries </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../infrastructure-implementation-summary.md class=md-nav__link> <span class=md-ellipsis> Infrastructure </span> </a> </li> <li class=md-nav__item> <a href=../../security-implementation-summary.md class=md-nav__link> <span class=md-ellipsis> Security </span> </a> </li> <li class=md-nav__item> <a href=../../trust-infrastructure-implementation-plan.md class=md-nav__link> <span class=md-ellipsis> Trust Zones </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_2> <label class=md-nav__link for=__nav_7_2 id=__nav_7_2_label tabindex=0> <span class=md-ellipsis> Documentation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_2_label aria-expanded=false> <label class=md-nav__title for=__nav_7_2> <span class="md-nav__icon md-icon"></span> Documentation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../documentation-management-plan.md class=md-nav__link> <span class=md-ellipsis> Documentation Management Plan </span> </a> </li> <li class=md-nav__item> <a href=../../documentation-inventory.md class=md-nav__link> <span class=md-ellipsis> Documentation Inventory </span> </a> </li> <li class=md-nav__item> <a href=../../documentation-consolidation-progress/ class=md-nav__link> <span class=md-ellipsis> Documentation Consolidation Progress </span> </a> </li> <li class=md-nav__item> <a href=../../documentation-consolidation-workflow.md class=md-nav__link> <span class=md-ellipsis> Documentation Consolidation Workflow </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#table-of-contents class=md-nav__link> <span class=md-ellipsis> Table of Contents </span> </a> </li> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#system-architecture class=md-nav__link> <span class=md-ellipsis> System Architecture </span> </a> </li> <li class=md-nav__item> <a href=#phase-1-trust-infrastructure class=md-nav__link> <span class=md-ellipsis> Phase 1: Trust Infrastructure </span> </a> <nav class=md-nav aria-label="Phase 1: Trust Infrastructure"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-cross-chain-maily-token-implementation class=md-nav__link> <span class=md-ellipsis> 1. Cross-Chain $MAILY Token Implementation </span> </a> <nav class=md-nav aria-label="1. Cross-Chain $MAILY Token Implementation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#smart-contract-development class=md-nav__link> <span class=md-ellipsis> Smart Contract Development </span> </a> </li> <li class=md-nav__item> <a href=#chainlink-oracle-service class=md-nav__link> <span class=md-ellipsis> Chainlink Oracle Service </span> </a> </li> <li class=md-nav__item> <a href=#blockchainservice-implementation class=md-nav__link> <span class=md-ellipsis> BlockchainService Implementation </span> </a> </li> <li class=md-nav__item> <a href=#campaign-service-integration class=md-nav__link> <span class=md-ellipsis> Campaign Service Integration </span> </a> </li> <li class=md-nav__item> <a href=#database-schema-updates class=md-nav__link> <span class=md-ellipsis> Database Schema Updates </span> </a> </li> <li class=md-nav__item> <a href=#deployment-configuration-for-blockchain-infrastructure class=md-nav__link> <span class=md-ellipsis> Deployment Configuration for Blockchain Infrastructure </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-ai-trust-agents-with-predictive-personalization class=md-nav__link> <span class=md-ellipsis> 2. AI Trust Agents with Predictive Personalization </span> </a> <nav class=md-nav aria-label="2. AI Trust Agents with Predictive Personalization"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ai-trust-agent-implementation class=md-nav__link> <span class=md-ellipsis> AI Trust Agent Implementation </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=maily-trust-infrastructure-production-implementation-plan>MAILY Trust Infrastructure - Production Implementation Plan<a class=headerlink href=#maily-trust-infrastructure-production-implementation-plan title="Permanent link">&para;</a></h1> <p>This document outlines the comprehensive production implementation plan for integrating blockchain-verified metrics, AI-driven personalization, and trust-based mechanisms into the Maily platform.</p> <h2 id=table-of-contents>Table of Contents<a class=headerlink href=#table-of-contents title="Permanent link">&para;</a></h2> <ul> <li><a href=#overview>Overview</a></li> <li><a href=#system-architecture>System Architecture</a></li> <li><a href=#phase-1-trust-infrastructure>Phase 1: Trust Infrastructure</a></li> <li><a href=#1-cross-chain-maily-token-implementation>1. Cross-Chain $MAILY Token Implementation</a></li> <li><a href=#2-ai-trust-agents-with-predictive-personalization>2. AI Trust Agents with Predictive Personalization</a></li> <li><a href=#3-trust-certificates>3. Trust Certificates</a></li> <li><a href=#phase-2-viral-ignition>Phase 2: Viral Ignition</a></li> <li><a href=#1-twitter-trend-monitoring-and-campaign-generator>1. Twitter Trend Monitoring and Campaign Generator</a></li> <li><a href=#2-referral-system-with-trend-tokens-and-leaderboard>2. Referral System with Trend Tokens and Leaderboard</a></li> <li><a href=#3-trust-score-prediction-testing>3. Trust Score Prediction Testing</a></li> <li><a href=#phase-3-ecosystem-expansion>Phase 3: Ecosystem Expansion</a></li> <li><a href=#1-self-evolving-trust-rank-with-recipient-feedback-loops>1. Self-Evolving Trust Rank with Recipient Feedback Loops</a></li> <li><a href=#2-one-tap-onboarding-extension>2. One-Tap Onboarding Extension</a></li> <li><a href=#3-staking-mechanics-for-recipients>3. Staking Mechanics for Recipients</a></li> <li><a href=#integration-points>Integration Points</a></li> <li><a href=#deployment-strategy>Deployment Strategy</a></li> <li><a href=#security-considerations>Security Considerations</a></li> <li><a href=#performance-optimizations>Performance Optimizations</a></li> <li><a href=#testing-strategy>Testing Strategy</a></li> </ul> <h2 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">&para;</a></h2> <p>The MAILY Trust Infrastructure introduces blockchain technology and advanced AI capabilities to create a transparent, verifiable system for email marketing campaigns. This implementation establishes a foundation of trust between marketers and recipients while driving organic growth through engagement incentives.</p> <h2 id=system-architecture>System Architecture<a class=headerlink href=#system-architecture title="Permanent link">&para;</a></h2> <p><img alt="System Architecture" src=https://mermaid.ink/img/pako:eNqVVMtu2zAQ_BXCpw3aS4vCRZACboEGPRRtil4Mw1iTK4kJRRIkZTQI_O9dPvSIjbSFL-Jyd2Z2ZwN6JnbI8rQkNPl93qIT2l9XiLLlzjtqnVXNXdcZ-xDns4SYW-FaF40lZiX61Md5DRNQIgUP3JGB3-DeympA3lKcn3Hmv0HtBFVnOK8ZfoTl8WecL7xFcvqRB9-r8KzaqO-qnJOKYAWPpF7BQYZnf9ZDklE1-UYs5AG8L0B4jKJArhKgMMPo1_pANe0NTtrFn2YY62y_lnl7-1zCgWfP1Z8e-Ul6qdxrsJZXX3mfCXGfv1nKXf4Zyq2GFjMwUYzGjRpHlXzYw0q_kLYEp-Pz4KBDmxCbJ6y5v1RmL2pB-eXG8yXvV-YfTT35fxTfYMsXYg_wJ3vBSHSjWP_Oj5BE6wFvYkPTUF7v4kLOJpib0w40PcbhMkbG8PBGe7i3XPqzFFtZBCy_lsJYgVZ0Rm7pfaSQLsZ6oaHp_OZ7vMQC1oEeUKNoyd6vbnqeVoVcfu_zbGnYeVwC1AfYk0Knj_itNKtlUKY4eNMOiomcCmOv9K9G5zQ5vj6iuCPubmpt5BX7ohQN2R8Ey4pqHKMjOLBzkE5B-kjnsrIuQTpV1XXNHt_WiXQmQd2RnM_1RcdCkbekhk1dF5csOcpoScne_izrY1nVm812U9b1Zckye0Ad0J8etofNdnXYHfbrqqrrw_7gA9WJ3jl7kPnTp-1G78Zd--8_8YK88Q></p> <p>The architecture consists of:</p> <ol> <li><strong>Blockchain Layer</strong>: Smart contracts and on-chain infrastructure for token management, trust certificates, and reward mechanisms</li> <li><strong>AI Trust Layer</strong>: Advanced AI models for personalization, prediction, and engagement scoring</li> <li><strong>User Engagement Layer</strong>: Front-end interfaces, referral systems, and staking mechanics</li> <li><strong>Integration Layer</strong>: Components that connect existing Maily services with the new trust infrastructure</li> </ol> <h2 id=phase-1-trust-infrastructure>Phase 1: Trust Infrastructure<a class=headerlink href=#phase-1-trust-infrastructure title="Permanent link">&para;</a></h2> <h3 id=1-cross-chain-maily-token-implementation>1. Cross-Chain $MAILY Token Implementation<a class=headerlink href=#1-cross-chain-maily-token-implementation title="Permanent link">&para;</a></h3> <h4 id=smart-contract-development>Smart Contract Development<a class=headerlink href=#smart-contract-development title="Permanent link">&para;</a></h4> <p>Create a production-ready ERC20 token contract with cross-chain capabilities using LayerZero:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1>// contracts/MailyToken.sol</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=c1>// SPDX-License-Identifier: MIT</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=k>pragma solidity</span><span class=w> </span><span class=o>^</span><span class=k>0.8.20</span><span class=p>;</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=kt>import</span><span class=w> </span><span class=s2>&quot;@openzeppelin/contracts/token/ERC20/ERC20.sol&quot;</span><span class=p>;</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=kt>import</span><span class=w> </span><span class=s2>&quot;@openzeppelin/contracts/access/AccessControl.sol&quot;</span><span class=p>;</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=kt>import</span><span class=w> </span><span class=s2>&quot;@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol&quot;</span><span class=p>;</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=kt>import</span><span class=w> </span><span class=s2>&quot;@layerzerolabs/solidity-examples/contracts/token/oft/v2/OFTV2.sol&quot;</span><span class=p>;</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=k>contract</span><span class=w> </span><span class=ni>MailyToken</span><span class=w> </span><span class=kt>is</span><span class=w> </span>OFTV2<span class=p>,</span><span class=w> </span>AccessControl<span class=w> </span><span class=p>{</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=w>    </span><span class=kt>bytes32</span><span class=w> </span><span class=k>public </span><span class=nv>constant</span><span class=w> </span>MINTER_ROLE<span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>keccak256</span><span class=p>(</span><span class=s2>&quot;MINTER_ROLE&quot;</span><span class=p>);</span>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=w>    </span><span class=kt>bytes32</span><span class=w> </span><span class=k>public </span><span class=nv>constant</span><span class=w> </span>ORACLE_ROLE<span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>keccak256</span><span class=p>(</span><span class=s2>&quot;ORACLE_ROLE&quot;</span><span class=p>);</span>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=w>    </span><span class=kt>uint256</span><span class=w> </span><span class=k>public </span><span class=nv>constant</span><span class=w> </span>MAX_SUPPLY<span class=w> </span><span class=o>=</span><span class=w> </span><span class=err>1</span>_000_000_000<span class=w> </span><span class=o>*</span><span class=w> </span><span class="m m-Decimal">10</span><span class=o>**</span><span class="m m-Decimal">18</span><span class=p>;</span><span class=w> </span><span class=c1>// 1 billion tokens</span>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=w>    </span><span class=kt>mapping</span><span class=p>(</span><span class=kt>uint256</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=kt>bool</span><span class=p>)</span><span class=w> </span><span class=kt>public</span><span class=w> </span>campaignProcessed<span class=p>;</span>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=w>    </span><span class=kt>mapping</span><span class=p>(</span><span class=kt>address</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=kt>mapping</span><span class=p>(</span><span class=kt>uint256</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=kt>uint256</span><span class=p>))</span><span class=w> </span><span class=kt>public</span><span class=w> </span>performanceRewards<span class=p>;</span>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a><span class=w>    </span>AggregatorV3Interface<span class=w> </span><span class=kt>public</span><span class=w> </span>emailMetricsOracle<span class=p>;</span>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a>
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a><span class=w>    </span><span class=kt>event</span><span class=w> </span><span class=nv>CampaignRewardIssued</span><span class=p>(</span><span class=kt>address</span><span class=w> </span><span class=nv>indexed</span><span class=w> </span>marketer<span class=p>,</span><span class=w> </span><span class=kt>uint256</span><span class=w> </span><span class=nv>indexed</span><span class=w> </span>campaignId<span class=p>,</span><span class=w> </span><span class=kt>uint256</span><span class=w> </span><span class=nv>amount</span><span class=p>);</span>
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a>
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a><span class=w>    </span><span class=kt>constructor</span><span class=p>(</span>
<a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a><span class=w>        </span><span class=kt>string</span><span class=w> </span><span class=nv>memory</span><span class=w> </span>_name<span class=p>,</span>
<a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a><span class=w>        </span><span class=kt>string</span><span class=w> </span><span class=nv>memory</span><span class=w> </span>_symbol<span class=p>,</span>
<a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a><span class=w>        </span><span class=kt>address</span><span class=w> </span><span class=nv>_layerZeroEndpoint</span><span class=p>,</span>
<a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a><span class=w>        </span><span class=kt>address</span><span class=w> </span><span class=nv>_oracleAddress</span>
<a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a><span class=w>    </span><span class=p>)</span><span class=w> </span>OFTV2<span class=p>(</span>_name<span class=p>,</span><span class=w> </span>_symbol<span class=p>,</span><span class=w> </span><span class="m m-Decimal">18</span><span class=p>,</span><span class=w> </span>_layerZeroEndpoint<span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a><span class=w>        </span>_grantRole<span class=p>(</span>DEFAULT_ADMIN_ROLE<span class=p>,</span><span class=w> </span><span class=k>msg.sender</span><span class=p>);</span>
<a id=__codelineno-0-29 name=__codelineno-0-29 href=#__codelineno-0-29></a><span class=w>        </span>_grantRole<span class=p>(</span>MINTER_ROLE<span class=p>,</span><span class=w> </span><span class=k>msg.sender</span><span class=p>);</span>
<a id=__codelineno-0-30 name=__codelineno-0-30 href=#__codelineno-0-30></a><span class=w>        </span>emailMetricsOracle<span class=w> </span><span class=o>=</span><span class=w> </span>AggregatorV3Interface<span class=p>(</span>_oracleAddress<span class=p>);</span>
<a id=__codelineno-0-31 name=__codelineno-0-31 href=#__codelineno-0-31></a>
<a id=__codelineno-0-32 name=__codelineno-0-32 href=#__codelineno-0-32></a><span class=w>        </span><span class=c1>// Mint initial supply</span>
<a id=__codelineno-0-33 name=__codelineno-0-33 href=#__codelineno-0-33></a><span class=w>        </span>_mint<span class=p>(</span><span class=k>msg.sender</span><span class=p>,</span><span class=w> </span>MAX_SUPPLY<span class=w> </span><span class=o>/</span><span class=w> </span><span class="m m-Decimal">2</span><span class=p>);</span>
<a id=__codelineno-0-34 name=__codelineno-0-34 href=#__codelineno-0-34></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-0-35 name=__codelineno-0-35 href=#__codelineno-0-35></a>
<a id=__codelineno-0-36 name=__codelineno-0-36 href=#__codelineno-0-36></a><span class=w>    </span><span class=kt>function</span><span class=w> </span><span class=nv>mintBasedOnPerformance</span><span class=p>(</span>
<a id=__codelineno-0-37 name=__codelineno-0-37 href=#__codelineno-0-37></a><span class=w>        </span><span class=kt>address</span><span class=w> </span><span class=nv>marketer</span><span class=p>,</span>
<a id=__codelineno-0-38 name=__codelineno-0-38 href=#__codelineno-0-38></a><span class=w>        </span><span class=kt>uint256</span><span class=w> </span><span class=nv>campaignId</span><span class=p>,</span>
<a id=__codelineno-0-39 name=__codelineno-0-39 href=#__codelineno-0-39></a><span class=w>        </span><span class=kt>uint256</span><span class=w> </span><span class=nv>openRate</span><span class=p>,</span>
<a id=__codelineno-0-40 name=__codelineno-0-40 href=#__codelineno-0-40></a><span class=w>        </span><span class=kt>uint256</span><span class=w> </span><span class=nv>clickRate</span>
<a id=__codelineno-0-41 name=__codelineno-0-41 href=#__codelineno-0-41></a><span class=w>    </span><span class=p>)</span><span class=w> </span><span class=kt>external</span><span class=w> </span>onlyRole<span class=p>(</span>MINTER_ROLE<span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-0-42 name=__codelineno-0-42 href=#__codelineno-0-42></a><span class=w>        </span><span class=kt>require</span><span class=p>(</span><span class=o>!</span>campaignProcessed<span class=p>[</span>campaignId<span class=p>],</span><span class=w> </span><span class=s2>&quot;Campaign already processed&quot;</span><span class=p>);</span>
<a id=__codelineno-0-43 name=__codelineno-0-43 href=#__codelineno-0-43></a>
<a id=__codelineno-0-44 name=__codelineno-0-44 href=#__codelineno-0-44></a><span class=w>        </span><span class=c1>// Calculate reward based on open rate and click rate (converted to basis points)</span>
<a id=__codelineno-0-45 name=__codelineno-0-45 href=#__codelineno-0-45></a><span class=w>        </span><span class=kt>uint256</span><span class=w> </span><span class=nv>reward</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span>openRate<span class=w> </span><span class=o>*</span><span class=w> </span><span class="m m-Decimal">5</span><span class=w> </span><span class=o>+</span><span class=w> </span>clickRate<span class=w> </span><span class=o>*</span><span class=w> </span><span class="m m-Decimal">10</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class="m m-Decimal">10</span><span class=o>**</span><span class="m m-Decimal">16</span><span class=p>;</span>
<a id=__codelineno-0-46 name=__codelineno-0-46 href=#__codelineno-0-46></a><span class=w>        </span><span class=kt>require</span><span class=p>(</span>totalSupply<span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span>reward<span class=w> </span><span class=o>&lt;=</span><span class=w> </span>MAX_SUPPLY<span class=p>,</span><span class=w> </span><span class=s2>&quot;Exceeds max supply&quot;</span><span class=p>);</span>
<a id=__codelineno-0-47 name=__codelineno-0-47 href=#__codelineno-0-47></a>
<a id=__codelineno-0-48 name=__codelineno-0-48 href=#__codelineno-0-48></a><span class=w>        </span>_mint<span class=p>(</span>marketer<span class=p>,</span><span class=w> </span>reward<span class=p>);</span>
<a id=__codelineno-0-49 name=__codelineno-0-49 href=#__codelineno-0-49></a><span class=w>        </span>performanceRewards<span class=p>[</span>marketer<span class=p>][</span>campaignId<span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span>reward<span class=p>;</span>
<a id=__codelineno-0-50 name=__codelineno-0-50 href=#__codelineno-0-50></a><span class=w>        </span>campaignProcessed<span class=p>[</span>campaignId<span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kt>true</span><span class=p>;</span>
<a id=__codelineno-0-51 name=__codelineno-0-51 href=#__codelineno-0-51></a>
<a id=__codelineno-0-52 name=__codelineno-0-52 href=#__codelineno-0-52></a><span class=w>        </span>emit<span class=w> </span>CampaignRewardIssued<span class=p>(</span>marketer<span class=p>,</span><span class=w> </span>campaignId<span class=p>,</span><span class=w> </span>reward<span class=p>);</span>
<a id=__codelineno-0-53 name=__codelineno-0-53 href=#__codelineno-0-53></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-0-54 name=__codelineno-0-54 href=#__codelineno-0-54></a>
<a id=__codelineno-0-55 name=__codelineno-0-55 href=#__codelineno-0-55></a><span class=w>    </span><span class=kt>function</span><span class=w> </span><span class=nv>updateOracleAddress</span><span class=p>(</span><span class=kt>address</span><span class=w> </span><span class=nv>_oracleAddress</span><span class=p>)</span><span class=w> </span><span class=kt>external</span><span class=w> </span>onlyRole<span class=p>(</span>DEFAULT_ADMIN_ROLE<span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-0-56 name=__codelineno-0-56 href=#__codelineno-0-56></a><span class=w>        </span>emailMetricsOracle<span class=w> </span><span class=o>=</span><span class=w> </span>AggregatorV3Interface<span class=p>(</span>_oracleAddress<span class=p>);</span>
<a id=__codelineno-0-57 name=__codelineno-0-57 href=#__codelineno-0-57></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-0-58 name=__codelineno-0-58 href=#__codelineno-0-58></a>
<a id=__codelineno-0-59 name=__codelineno-0-59 href=#__codelineno-0-59></a><span class=w>    </span><span class=c1>// Override required function in AccessControl</span>
<a id=__codelineno-0-60 name=__codelineno-0-60 href=#__codelineno-0-60></a><span class=w>    </span><span class=kt>function</span><span class=w> </span><span class=nv>supportsInterface</span><span class=p>(</span>bytes4<span class=w> </span>interfaceId<span class=p>)</span><span class=w> </span><span class=kt>public</span><span class=w> </span>view<span class=w> </span>virtual<span class=w> </span>override<span class=p>(</span>AccessControl<span class=p>,</span><span class=w> </span>OFTV2<span class=p>)</span><span class=w> </span><span class=kt>returns</span><span class=w> </span><span class=p>(</span><span class=kt>bool</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-0-61 name=__codelineno-0-61 href=#__codelineno-0-61></a><span class=w>        </span><span class=kt>return</span><span class=w> </span>super<span class=p>.</span>supportsInterface<span class=p>(</span>interfaceId<span class=p>);</span>
<a id=__codelineno-0-62 name=__codelineno-0-62 href=#__codelineno-0-62></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-0-63 name=__codelineno-0-63 href=#__codelineno-0-63></a><span class=p>}</span>
</code></pre></div> <h4 id=chainlink-oracle-service>Chainlink Oracle Service<a class=headerlink href=#chainlink-oracle-service title="Permanent link">&para;</a></h4> <p>Create an External Adapter for Chainlink to feed email metrics data to the blockchain:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1>// packages/blockchain/oracles/email-metrics-adapter.js</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>Requester</span><span class=p>,</span><span class=w> </span><span class=nx>Validator</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;@chainlink/external-adapter&#39;</span><span class=p>);</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=kd>const</span><span class=w> </span><span class=nx>ethers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;ethers&#39;</span><span class=p>);</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=c1>// Define custom error messages</span>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=kd>const</span><span class=w> </span><span class=nx>customError</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=nx>data</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>Response</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s1>&#39;Error&#39;</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=p>};</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=c1>// Define custom parameters</span>
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=kd>const</span><span class=w> </span><span class=nx>customParams</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=w>  </span><span class=nx>campaignId</span><span class=o>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;campaignId&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;campaign&#39;</span><span class=p>],</span>
<a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=w>  </span><span class=nx>marketerAddress</span><span class=o>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;marketerAddress&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;marketer&#39;</span><span class=p>],</span>
<a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a><span class=w>  </span><span class=nx>endpoint</span><span class=o>:</span><span class=w> </span><span class=kc>false</span>
<a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a><span class=p>};</span>
<a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a>
<a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=c1>// Create request handler</span>
<a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a><span class=kd>const</span><span class=w> </span><span class=nx>createRequest</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=nx>input</span><span class=p>,</span><span class=w> </span><span class=nx>callback</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a><span class=w>  </span><span class=c1>// Validate input data</span>
<a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>validator</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>Validator</span><span class=p>(</span><span class=nx>input</span><span class=p>,</span><span class=w> </span><span class=nx>customParams</span><span class=p>);</span>
<a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>jobRunID</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>validator</span><span class=p>.</span><span class=nx>validated</span><span class=p>.</span><span class=nx>id</span><span class=p>;</span>
<a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>campaignId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>validator</span><span class=p>.</span><span class=nx>validated</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>campaignId</span><span class=p>;</span>
<a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>marketerAddress</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>validator</span><span class=p>.</span><span class=nx>validated</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>marketerAddress</span><span class=p>;</span>
<a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>endpoint</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>validator</span><span class=p>.</span><span class=nx>validated</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>endpoint</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=s1>&#39;metrics&#39;</span><span class=p>;</span>
<a id=__codelineno-1-26 name=__codelineno-1-26 href=#__codelineno-1-26></a>
<a id=__codelineno-1-27 name=__codelineno-1-27 href=#__codelineno-1-27></a><span class=w>  </span><span class=c1>// In production, this should be configured with environment variables</span>
<a id=__codelineno-1-28 name=__codelineno-1-28 href=#__codelineno-1-28></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>url</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=sb>`https://api.maily.app/campaigns/</span><span class=si>${</span><span class=nx>campaignId</span><span class=si>}</span><span class=sb>/</span><span class=si>${</span><span class=nx>endpoint</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
<a id=__codelineno-1-29 name=__codelineno-1-29 href=#__codelineno-1-29></a>
<a id=__codelineno-1-30 name=__codelineno-1-30 href=#__codelineno-1-30></a><span class=w>  </span><span class=c1>// Set request parameters</span>
<a id=__codelineno-1-31 name=__codelineno-1-31 href=#__codelineno-1-31></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>params</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-32 name=__codelineno-1-32 href=#__codelineno-1-32></a><span class=w>    </span><span class=nx>campaignId</span>
<a id=__codelineno-1-33 name=__codelineno-1-33 href=#__codelineno-1-33></a><span class=w>  </span><span class=p>};</span>
<a id=__codelineno-1-34 name=__codelineno-1-34 href=#__codelineno-1-34></a>
<a id=__codelineno-1-35 name=__codelineno-1-35 href=#__codelineno-1-35></a><span class=w>  </span><span class=c1>// Set custom error handling</span>
<a id=__codelineno-1-36 name=__codelineno-1-36 href=#__codelineno-1-36></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>customError</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=nx>data</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-37 name=__codelineno-1-37 href=#__codelineno-1-37></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>Response</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s1>&#39;Error&#39;</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span>
<a id=__codelineno-1-38 name=__codelineno-1-38 href=#__codelineno-1-38></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span>
<a id=__codelineno-1-39 name=__codelineno-1-39 href=#__codelineno-1-39></a><span class=w>  </span><span class=p>};</span>
<a id=__codelineno-1-40 name=__codelineno-1-40 href=#__codelineno-1-40></a>
<a id=__codelineno-1-41 name=__codelineno-1-41 href=#__codelineno-1-41></a><span class=w>  </span><span class=c1>// Make the request to the API</span>
<a id=__codelineno-1-42 name=__codelineno-1-42 href=#__codelineno-1-42></a><span class=w>  </span><span class=nx>Requester</span><span class=p>.</span><span class=nx>request</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-43 name=__codelineno-1-43 href=#__codelineno-1-43></a><span class=w>    </span><span class=nx>params</span><span class=p>,</span>
<a id=__codelineno-1-44 name=__codelineno-1-44 href=#__codelineno-1-44></a><span class=w>    </span><span class=nx>customError</span>
<a id=__codelineno-1-45 name=__codelineno-1-45 href=#__codelineno-1-45></a><span class=w>  </span><span class=p>})</span>
<a id=__codelineno-1-46 name=__codelineno-1-46 href=#__codelineno-1-46></a><span class=w>    </span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>response</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-47 name=__codelineno-1-47 href=#__codelineno-1-47></a><span class=w>      </span><span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-48 name=__codelineno-1-48 href=#__codelineno-1-48></a><span class=w>        </span><span class=nx>openRate</span><span class=o>:</span><span class=w> </span><span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>openRate</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>10000</span><span class=p>),</span><span class=w> </span><span class=c1>// Convert to basis points (0.1543 -&gt; 1543)</span>
<a id=__codelineno-1-49 name=__codelineno-1-49 href=#__codelineno-1-49></a><span class=w>        </span><span class=nx>clickRate</span><span class=o>:</span><span class=w> </span><span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>clickRate</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>10000</span><span class=p>),</span><span class=w> </span><span class=c1>// Convert to basis points</span>
<a id=__codelineno-1-50 name=__codelineno-1-50 href=#__codelineno-1-50></a><span class=w>        </span><span class=nx>bounceRate</span><span class=o>:</span><span class=w> </span><span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>bounceRate</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>10000</span><span class=p>),</span><span class=w> </span><span class=c1>// Convert to basis points</span>
<a id=__codelineno-1-51 name=__codelineno-1-51 href=#__codelineno-1-51></a><span class=w>        </span><span class=nx>marketerAddress</span><span class=p>,</span>
<a id=__codelineno-1-52 name=__codelineno-1-52 href=#__codelineno-1-52></a><span class=w>        </span><span class=nx>campaignId</span><span class=p>,</span>
<a id=__codelineno-1-53 name=__codelineno-1-53 href=#__codelineno-1-53></a><span class=w>        </span><span class=nx>timestamp</span><span class=o>:</span><span class=w> </span><span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mf>1000</span><span class=p>)</span>
<a id=__codelineno-1-54 name=__codelineno-1-54 href=#__codelineno-1-54></a><span class=w>      </span><span class=p>};</span>
<a id=__codelineno-1-55 name=__codelineno-1-55 href=#__codelineno-1-55></a>
<a id=__codelineno-1-56 name=__codelineno-1-56 href=#__codelineno-1-56></a><span class=w>      </span><span class=nx>callback</span><span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>status</span><span class=p>,</span><span class=w> </span><span class=nx>Requester</span><span class=p>.</span><span class=nx>success</span><span class=p>(</span><span class=nx>jobRunID</span><span class=p>,</span><span class=w> </span><span class=nx>response</span><span class=p>));</span>
<a id=__codelineno-1-57 name=__codelineno-1-57 href=#__codelineno-1-57></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-1-58 name=__codelineno-1-58 href=#__codelineno-1-58></a><span class=w>    </span><span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>error</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-59 name=__codelineno-1-59 href=#__codelineno-1-59></a><span class=w>      </span><span class=nx>callback</span><span class=p>(</span><span class=mf>500</span><span class=p>,</span><span class=w> </span><span class=nx>Requester</span><span class=p>.</span><span class=nx>errored</span><span class=p>(</span><span class=nx>jobRunID</span><span class=p>,</span><span class=w> </span><span class=nx>error</span><span class=p>));</span>
<a id=__codelineno-1-60 name=__codelineno-1-60 href=#__codelineno-1-60></a><span class=w>    </span><span class=p>});</span>
<a id=__codelineno-1-61 name=__codelineno-1-61 href=#__codelineno-1-61></a><span class=p>};</span>
<a id=__codelineno-1-62 name=__codelineno-1-62 href=#__codelineno-1-62></a>
<a id=__codelineno-1-63 name=__codelineno-1-63 href=#__codelineno-1-63></a><span class=c1>// Export handler for serverless function</span>
<a id=__codelineno-1-64 name=__codelineno-1-64 href=#__codelineno-1-64></a><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=p>.</span><span class=nx>createRequest</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createRequest</span><span class=p>;</span>
</code></pre></div> <h4 id=blockchainservice-implementation>BlockchainService Implementation<a class=headerlink href=#blockchainservice-implementation title="Permanent link">&para;</a></h4> <p>Create a service to interact with the blockchain contracts:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1># packages/blockchain/services/blockchain_service.py</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=kn>import</span><span class=w> </span><span class=nn>os</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=kn>import</span><span class=w> </span><span class=nn>asyncio</span>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span><span class=p>,</span> <span class=n>Optional</span>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=kn>from</span><span class=w> </span><span class=nn>eth_account</span><span class=w> </span><span class=kn>import</span> <span class=n>Account</span>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=kn>from</span><span class=w> </span><span class=nn>eth_account.signers.local</span><span class=w> </span><span class=kn>import</span> <span class=n>LocalAccount</span>
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=kn>from</span><span class=w> </span><span class=nn>web3</span><span class=w> </span><span class=kn>import</span> <span class=n>Web3</span><span class=p>,</span> <span class=n>AsyncHTTPProvider</span>
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=kn>from</span><span class=w> </span><span class=nn>web3.middleware</span><span class=w> </span><span class=kn>import</span> <span class=n>geth_poa_middleware</span>
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=kn>import</span><span class=w> </span><span class=nn>httpx</span>
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a>
<a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=k>class</span><span class=w> </span><span class=nc>BlockchainService</span><span class=p>:</span>
<a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Service for blockchain interactions.&quot;&quot;&quot;</span>
<a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a>
<a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>settings</span><span class=p>):</span>
<a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Initialize the blockchain service.&quot;&quot;&quot;</span>
<a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a>        <span class=bp>self</span><span class=o>.</span><span class=n>settings</span> <span class=o>=</span> <span class=n>settings</span>
<a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a>
<a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a>        <span class=c1># Initialize web3 provider</span>
<a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a>        <span class=bp>self</span><span class=o>.</span><span class=n>w3</span> <span class=o>=</span> <span class=n>Web3</span><span class=p>(</span><span class=n>Web3</span><span class=o>.</span><span class=n>HTTPProvider</span><span class=p>(</span><span class=n>settings</span><span class=o>.</span><span class=n>ETHEREUM_RPC_URL</span><span class=p>))</span>
<a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a>        <span class=bp>self</span><span class=o>.</span><span class=n>w3</span><span class=o>.</span><span class=n>middleware_onion</span><span class=o>.</span><span class=n>inject</span><span class=p>(</span><span class=n>geth_poa_middleware</span><span class=p>,</span> <span class=n>layer</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
<a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a>
<a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a>        <span class=c1># Initialize account</span>
<a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a>        <span class=bp>self</span><span class=o>.</span><span class=n>private_key</span> <span class=o>=</span> <span class=n>settings</span><span class=o>.</span><span class=n>BLOCKCHAIN_PRIVATE_KEY</span>
<a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>private_key</span><span class=p>:</span>
<a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a>            <span class=bp>self</span><span class=o>.</span><span class=n>account</span><span class=p>:</span> <span class=n>LocalAccount</span> <span class=o>=</span> <span class=n>Account</span><span class=o>.</span><span class=n>from_key</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>private_key</span><span class=p>)</span>
<a id=__codelineno-2-27 name=__codelineno-2-27 href=#__codelineno-2-27></a>            <span class=bp>self</span><span class=o>.</span><span class=n>account_address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>account</span><span class=o>.</span><span class=n>address</span>
<a id=__codelineno-2-28 name=__codelineno-2-28 href=#__codelineno-2-28></a>        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-2-29 name=__codelineno-2-29 href=#__codelineno-2-29></a>            <span class=bp>self</span><span class=o>.</span><span class=n>account</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-2-30 name=__codelineno-2-30 href=#__codelineno-2-30></a>            <span class=bp>self</span><span class=o>.</span><span class=n>account_address</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-2-31 name=__codelineno-2-31 href=#__codelineno-2-31></a>
<a id=__codelineno-2-32 name=__codelineno-2-32 href=#__codelineno-2-32></a>        <span class=c1># Load contract ABIs</span>
<a id=__codelineno-2-33 name=__codelineno-2-33 href=#__codelineno-2-33></a>        <span class=bp>self</span><span class=o>.</span><span class=n>token_contract</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_load_contract</span><span class=p>(</span><span class=s1>&#39;MailyToken&#39;</span><span class=p>,</span> <span class=n>settings</span><span class=o>.</span><span class=n>MAILY_TOKEN_ADDRESS</span><span class=p>)</span>
<a id=__codelineno-2-34 name=__codelineno-2-34 href=#__codelineno-2-34></a>        <span class=bp>self</span><span class=o>.</span><span class=n>certificate_contract</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_load_contract</span><span class=p>(</span><span class=s1>&#39;TrustCertificate&#39;</span><span class=p>,</span> <span class=n>settings</span><span class=o>.</span><span class=n>TRUST_CERTIFICATE_ADDRESS</span><span class=p>)</span>
<a id=__codelineno-2-35 name=__codelineno-2-35 href=#__codelineno-2-35></a>
<a id=__codelineno-2-36 name=__codelineno-2-36 href=#__codelineno-2-36></a>        <span class=c1># Initialize HTTP client for API calls</span>
<a id=__codelineno-2-37 name=__codelineno-2-37 href=#__codelineno-2-37></a>        <span class=bp>self</span><span class=o>.</span><span class=n>http_client</span> <span class=o>=</span> <span class=n>httpx</span><span class=o>.</span><span class=n>AsyncClient</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mf>30.0</span><span class=p>)</span>
<a id=__codelineno-2-38 name=__codelineno-2-38 href=#__codelineno-2-38></a>
<a id=__codelineno-2-39 name=__codelineno-2-39 href=#__codelineno-2-39></a>    <span class=k>def</span><span class=w> </span><span class=nf>_load_contract</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>contract_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>contract_address</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
<a id=__codelineno-2-40 name=__codelineno-2-40 href=#__codelineno-2-40></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Load a contract from its ABI file.&quot;&quot;&quot;</span>
<a id=__codelineno-2-41 name=__codelineno-2-41 href=#__codelineno-2-41></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>contract_address</span><span class=p>:</span>
<a id=__codelineno-2-42 name=__codelineno-2-42 href=#__codelineno-2-42></a>            <span class=k>return</span> <span class=kc>None</span>
<a id=__codelineno-2-43 name=__codelineno-2-43 href=#__codelineno-2-43></a>
<a id=__codelineno-2-44 name=__codelineno-2-44 href=#__codelineno-2-44></a>        <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-2-45 name=__codelineno-2-45 href=#__codelineno-2-45></a>            <span class=c1># Load ABI from file</span>
<a id=__codelineno-2-46 name=__codelineno-2-46 href=#__codelineno-2-46></a>            <span class=n>abi_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
<a id=__codelineno-2-47 name=__codelineno-2-47 href=#__codelineno-2-47></a>                <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=vm>__file__</span><span class=p>),</span>
<a id=__codelineno-2-48 name=__codelineno-2-48 href=#__codelineno-2-48></a>                <span class=sa>f</span><span class=s1>&#39;../contracts/</span><span class=si>{</span><span class=n>contract_name</span><span class=si>}</span><span class=s1>.json&#39;</span>
<a id=__codelineno-2-49 name=__codelineno-2-49 href=#__codelineno-2-49></a>            <span class=p>)</span>
<a id=__codelineno-2-50 name=__codelineno-2-50 href=#__codelineno-2-50></a>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>abi_path</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
<a id=__codelineno-2-51 name=__codelineno-2-51 href=#__codelineno-2-51></a>                <span class=n>contract_data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
<a id=__codelineno-2-52 name=__codelineno-2-52 href=#__codelineno-2-52></a>                <span class=n>abi</span> <span class=o>=</span> <span class=n>contract_data</span><span class=p>[</span><span class=s1>&#39;abi&#39;</span><span class=p>]</span>
<a id=__codelineno-2-53 name=__codelineno-2-53 href=#__codelineno-2-53></a>
<a id=__codelineno-2-54 name=__codelineno-2-54 href=#__codelineno-2-54></a>            <span class=c1># Create contract instance</span>
<a id=__codelineno-2-55 name=__codelineno-2-55 href=#__codelineno-2-55></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>w3</span><span class=o>.</span><span class=n>eth</span><span class=o>.</span><span class=n>contract</span><span class=p>(</span><span class=n>address</span><span class=o>=</span><span class=n>contract_address</span><span class=p>,</span> <span class=n>abi</span><span class=o>=</span><span class=n>abi</span><span class=p>)</span>
<a id=__codelineno-2-56 name=__codelineno-2-56 href=#__codelineno-2-56></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-2-57 name=__codelineno-2-57 href=#__codelineno-2-57></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error loading contract </span><span class=si>{</span><span class=n>contract_name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-2-58 name=__codelineno-2-58 href=#__codelineno-2-58></a>            <span class=k>return</span> <span class=kc>None</span>
<a id=__codelineno-2-59 name=__codelineno-2-59 href=#__codelineno-2-59></a>
<a id=__codelineno-2-60 name=__codelineno-2-60 href=#__codelineno-2-60></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>mint_tokens_for_campaign</span><span class=p>(</span>
<a id=__codelineno-2-61 name=__codelineno-2-61 href=#__codelineno-2-61></a>        <span class=bp>self</span><span class=p>,</span>
<a id=__codelineno-2-62 name=__codelineno-2-62 href=#__codelineno-2-62></a>        <span class=n>campaign_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
<a id=__codelineno-2-63 name=__codelineno-2-63 href=#__codelineno-2-63></a>        <span class=n>marketer_address</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-2-64 name=__codelineno-2-64 href=#__codelineno-2-64></a>        <span class=n>metrics</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span>
<a id=__codelineno-2-65 name=__codelineno-2-65 href=#__codelineno-2-65></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<a id=__codelineno-2-66 name=__codelineno-2-66 href=#__codelineno-2-66></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Mint tokens based on campaign performance.&quot;&quot;&quot;</span>
<a id=__codelineno-2-67 name=__codelineno-2-67 href=#__codelineno-2-67></a>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>token_contract</span> <span class=ow>or</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>account</span><span class=p>:</span>
<a id=__codelineno-2-68 name=__codelineno-2-68 href=#__codelineno-2-68></a>            <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;error&quot;</span><span class=p>:</span> <span class=s2>&quot;Token contract or account not configured&quot;</span><span class=p>}</span>
<a id=__codelineno-2-69 name=__codelineno-2-69 href=#__codelineno-2-69></a>
<a id=__codelineno-2-70 name=__codelineno-2-70 href=#__codelineno-2-70></a>        <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-2-71 name=__codelineno-2-71 href=#__codelineno-2-71></a>            <span class=c1># Convert metrics to basis points</span>
<a id=__codelineno-2-72 name=__codelineno-2-72 href=#__codelineno-2-72></a>            <span class=n>open_rate_bp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>metrics</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;open_rate&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=o>*</span> <span class=mi>10000</span><span class=p>)</span>
<a id=__codelineno-2-73 name=__codelineno-2-73 href=#__codelineno-2-73></a>            <span class=n>click_rate_bp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>metrics</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;click_rate&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=o>*</span> <span class=mi>10000</span><span class=p>)</span>
<a id=__codelineno-2-74 name=__codelineno-2-74 href=#__codelineno-2-74></a>
<a id=__codelineno-2-75 name=__codelineno-2-75 href=#__codelineno-2-75></a>            <span class=c1># Build transaction</span>
<a id=__codelineno-2-76 name=__codelineno-2-76 href=#__codelineno-2-76></a>            <span class=n>nonce</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>w3</span><span class=o>.</span><span class=n>eth</span><span class=o>.</span><span class=n>get_transaction_count</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>account_address</span><span class=p>)</span>
<a id=__codelineno-2-77 name=__codelineno-2-77 href=#__codelineno-2-77></a>            <span class=n>tx</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>token_contract</span><span class=o>.</span><span class=n>functions</span><span class=o>.</span><span class=n>mintBasedOnPerformance</span><span class=p>(</span>
<a id=__codelineno-2-78 name=__codelineno-2-78 href=#__codelineno-2-78></a>                <span class=n>marketer_address</span><span class=p>,</span>
<a id=__codelineno-2-79 name=__codelineno-2-79 href=#__codelineno-2-79></a>                <span class=n>campaign_id</span><span class=p>,</span>
<a id=__codelineno-2-80 name=__codelineno-2-80 href=#__codelineno-2-80></a>                <span class=n>open_rate_bp</span><span class=p>,</span>
<a id=__codelineno-2-81 name=__codelineno-2-81 href=#__codelineno-2-81></a>                <span class=n>click_rate_bp</span>
<a id=__codelineno-2-82 name=__codelineno-2-82 href=#__codelineno-2-82></a>            <span class=p>)</span><span class=o>.</span><span class=n>build_transaction</span><span class=p>({</span>
<a id=__codelineno-2-83 name=__codelineno-2-83 href=#__codelineno-2-83></a>                <span class=s1>&#39;chainId&#39;</span><span class=p>:</span> <span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>settings</span><span class=o>.</span><span class=n>ETHEREUM_CHAIN_ID</span><span class=p>),</span>
<a id=__codelineno-2-84 name=__codelineno-2-84 href=#__codelineno-2-84></a>                <span class=s1>&#39;gas&#39;</span><span class=p>:</span> <span class=mi>200000</span><span class=p>,</span>
<a id=__codelineno-2-85 name=__codelineno-2-85 href=#__codelineno-2-85></a>                <span class=s1>&#39;gasPrice&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>w3</span><span class=o>.</span><span class=n>eth</span><span class=o>.</span><span class=n>gas_price</span><span class=p>,</span>
<a id=__codelineno-2-86 name=__codelineno-2-86 href=#__codelineno-2-86></a>                <span class=s1>&#39;nonce&#39;</span><span class=p>:</span> <span class=n>nonce</span><span class=p>,</span>
<a id=__codelineno-2-87 name=__codelineno-2-87 href=#__codelineno-2-87></a>            <span class=p>})</span>
<a id=__codelineno-2-88 name=__codelineno-2-88 href=#__codelineno-2-88></a>
<a id=__codelineno-2-89 name=__codelineno-2-89 href=#__codelineno-2-89></a>            <span class=c1># Sign and send transaction</span>
<a id=__codelineno-2-90 name=__codelineno-2-90 href=#__codelineno-2-90></a>            <span class=n>signed_tx</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>account</span><span class=o>.</span><span class=n>sign_transaction</span><span class=p>(</span><span class=n>tx</span><span class=p>)</span>
<a id=__codelineno-2-91 name=__codelineno-2-91 href=#__codelineno-2-91></a>            <span class=n>tx_hash</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>w3</span><span class=o>.</span><span class=n>eth</span><span class=o>.</span><span class=n>send_raw_transaction</span><span class=p>(</span><span class=n>signed_tx</span><span class=o>.</span><span class=n>rawTransaction</span><span class=p>)</span>
<a id=__codelineno-2-92 name=__codelineno-2-92 href=#__codelineno-2-92></a>
<a id=__codelineno-2-93 name=__codelineno-2-93 href=#__codelineno-2-93></a>            <span class=c1># Wait for transaction receipt</span>
<a id=__codelineno-2-94 name=__codelineno-2-94 href=#__codelineno-2-94></a>            <span class=n>receipt</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>w3</span><span class=o>.</span><span class=n>eth</span><span class=o>.</span><span class=n>wait_for_transaction_receipt</span><span class=p>(</span><span class=n>tx_hash</span><span class=p>)</span>
<a id=__codelineno-2-95 name=__codelineno-2-95 href=#__codelineno-2-95></a>
<a id=__codelineno-2-96 name=__codelineno-2-96 href=#__codelineno-2-96></a>            <span class=c1># Calculate token amount from logs</span>
<a id=__codelineno-2-97 name=__codelineno-2-97 href=#__codelineno-2-97></a>            <span class=n>logs</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>token_contract</span><span class=o>.</span><span class=n>events</span><span class=o>.</span><span class=n>CampaignRewardIssued</span><span class=p>()</span><span class=o>.</span><span class=n>process_receipt</span><span class=p>(</span><span class=n>receipt</span><span class=p>)</span>
<a id=__codelineno-2-98 name=__codelineno-2-98 href=#__codelineno-2-98></a>            <span class=n>token_amount</span> <span class=o>=</span> <span class=n>logs</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;args&#39;</span><span class=p>][</span><span class=s1>&#39;amount&#39;</span><span class=p>]</span> <span class=k>if</span> <span class=n>logs</span> <span class=k>else</span> <span class=mi>0</span>
<a id=__codelineno-2-99 name=__codelineno-2-99 href=#__codelineno-2-99></a>
<a id=__codelineno-2-100 name=__codelineno-2-100 href=#__codelineno-2-100></a>            <span class=k>return</span> <span class=p>{</span>
<a id=__codelineno-2-101 name=__codelineno-2-101 href=#__codelineno-2-101></a>                <span class=s2>&quot;success&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
<a id=__codelineno-2-102 name=__codelineno-2-102 href=#__codelineno-2-102></a>                <span class=s2>&quot;campaign_id&quot;</span><span class=p>:</span> <span class=n>campaign_id</span><span class=p>,</span>
<a id=__codelineno-2-103 name=__codelineno-2-103 href=#__codelineno-2-103></a>                <span class=s2>&quot;marketer_address&quot;</span><span class=p>:</span> <span class=n>marketer_address</span><span class=p>,</span>
<a id=__codelineno-2-104 name=__codelineno-2-104 href=#__codelineno-2-104></a>                <span class=s2>&quot;token_amount&quot;</span><span class=p>:</span> <span class=n>token_amount</span><span class=p>,</span>
<a id=__codelineno-2-105 name=__codelineno-2-105 href=#__codelineno-2-105></a>                <span class=s2>&quot;transaction_hash&quot;</span><span class=p>:</span> <span class=n>tx_hash</span><span class=o>.</span><span class=n>hex</span><span class=p>(),</span>
<a id=__codelineno-2-106 name=__codelineno-2-106 href=#__codelineno-2-106></a>                <span class=s2>&quot;block_number&quot;</span><span class=p>:</span> <span class=n>receipt</span><span class=o>.</span><span class=n>blockNumber</span><span class=p>,</span>
<a id=__codelineno-2-107 name=__codelineno-2-107 href=#__codelineno-2-107></a>                <span class=s2>&quot;explorer_url&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>settings</span><span class=o>.</span><span class=n>BLOCKCHAIN_EXPLORER_URL</span><span class=si>}</span><span class=s2>/tx/</span><span class=si>{</span><span class=n>tx_hash</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-2-108 name=__codelineno-2-108 href=#__codelineno-2-108></a>            <span class=p>}</span>
<a id=__codelineno-2-109 name=__codelineno-2-109 href=#__codelineno-2-109></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-2-110 name=__codelineno-2-110 href=#__codelineno-2-110></a>            <span class=k>return</span> <span class=p>{</span>
<a id=__codelineno-2-111 name=__codelineno-2-111 href=#__codelineno-2-111></a>                <span class=s2>&quot;success&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
<a id=__codelineno-2-112 name=__codelineno-2-112 href=#__codelineno-2-112></a>                <span class=s2>&quot;error&quot;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span>
<a id=__codelineno-2-113 name=__codelineno-2-113 href=#__codelineno-2-113></a>                <span class=s2>&quot;campaign_id&quot;</span><span class=p>:</span> <span class=n>campaign_id</span><span class=p>,</span>
<a id=__codelineno-2-114 name=__codelineno-2-114 href=#__codelineno-2-114></a>                <span class=s2>&quot;marketer_address&quot;</span><span class=p>:</span> <span class=n>marketer_address</span>
<a id=__codelineno-2-115 name=__codelineno-2-115 href=#__codelineno-2-115></a>            <span class=p>}</span>
<a id=__codelineno-2-116 name=__codelineno-2-116 href=#__codelineno-2-116></a>
<a id=__codelineno-2-117 name=__codelineno-2-117 href=#__codelineno-2-117></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>get_token_balance</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>address</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<a id=__codelineno-2-118 name=__codelineno-2-118 href=#__codelineno-2-118></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get token balance for an address.&quot;&quot;&quot;</span>
<a id=__codelineno-2-119 name=__codelineno-2-119 href=#__codelineno-2-119></a>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>token_contract</span><span class=p>:</span>
<a id=__codelineno-2-120 name=__codelineno-2-120 href=#__codelineno-2-120></a>            <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;error&quot;</span><span class=p>:</span> <span class=s2>&quot;Token contract not configured&quot;</span><span class=p>}</span>
<a id=__codelineno-2-121 name=__codelineno-2-121 href=#__codelineno-2-121></a>
<a id=__codelineno-2-122 name=__codelineno-2-122 href=#__codelineno-2-122></a>        <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-2-123 name=__codelineno-2-123 href=#__codelineno-2-123></a>            <span class=n>balance</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>token_contract</span><span class=o>.</span><span class=n>functions</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>(</span><span class=n>address</span><span class=p>)</span><span class=o>.</span><span class=n>call</span><span class=p>()</span>
<a id=__codelineno-2-124 name=__codelineno-2-124 href=#__codelineno-2-124></a>            <span class=n>decimals</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>token_contract</span><span class=o>.</span><span class=n>functions</span><span class=o>.</span><span class=n>decimals</span><span class=p>()</span><span class=o>.</span><span class=n>call</span><span class=p>()</span>
<a id=__codelineno-2-125 name=__codelineno-2-125 href=#__codelineno-2-125></a>
<a id=__codelineno-2-126 name=__codelineno-2-126 href=#__codelineno-2-126></a>            <span class=k>return</span> <span class=p>{</span>
<a id=__codelineno-2-127 name=__codelineno-2-127 href=#__codelineno-2-127></a>                <span class=s2>&quot;address&quot;</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span>
<a id=__codelineno-2-128 name=__codelineno-2-128 href=#__codelineno-2-128></a>                <span class=s2>&quot;balance&quot;</span><span class=p>:</span> <span class=n>balance</span><span class=p>,</span>
<a id=__codelineno-2-129 name=__codelineno-2-129 href=#__codelineno-2-129></a>                <span class=s2>&quot;formatted_balance&quot;</span><span class=p>:</span> <span class=n>balance</span> <span class=o>/</span> <span class=p>(</span><span class=mi>10</span> <span class=o>**</span> <span class=n>decimals</span><span class=p>),</span>
<a id=__codelineno-2-130 name=__codelineno-2-130 href=#__codelineno-2-130></a>                <span class=s2>&quot;token_symbol&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>token_contract</span><span class=o>.</span><span class=n>functions</span><span class=o>.</span><span class=n>symbol</span><span class=p>()</span><span class=o>.</span><span class=n>call</span><span class=p>()</span>
<a id=__codelineno-2-131 name=__codelineno-2-131 href=#__codelineno-2-131></a>            <span class=p>}</span>
<a id=__codelineno-2-132 name=__codelineno-2-132 href=#__codelineno-2-132></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-2-133 name=__codelineno-2-133 href=#__codelineno-2-133></a>            <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;error&quot;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span> <span class=s2>&quot;address&quot;</span><span class=p>:</span> <span class=n>address</span><span class=p>}</span>
<a id=__codelineno-2-134 name=__codelineno-2-134 href=#__codelineno-2-134></a>
<a id=__codelineno-2-135 name=__codelineno-2-135 href=#__codelineno-2-135></a>    <span class=c1># Other blockchain-related methods would be implemented here</span>
</code></pre></div> <h4 id=campaign-service-integration>Campaign Service Integration<a class=headerlink href=#campaign-service-integration title="Permanent link">&para;</a></h4> <p>Integrate the blockchain service with the campaign service:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=c1># apps/api/services/campaign_service.py</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span><span class=p>,</span> <span class=n>List</span><span class=p>,</span> <span class=n>Optional</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=kn>from</span><span class=w> </span><span class=nn>datetime</span><span class=w> </span><span class=kn>import</span> <span class=n>datetime</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=kn>from</span><span class=w> </span><span class=nn>..models</span><span class=w> </span><span class=kn>import</span> <span class=n>Campaign</span><span class=p>,</span> <span class=n>User</span><span class=p>,</span> <span class=n>CampaignMetrics</span>
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=kn>from</span><span class=w> </span><span class=nn>..config</span><span class=w> </span><span class=kn>import</span> <span class=n>Settings</span>
<a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=kn>from</span><span class=w> </span><span class=nn>..ai.trust_agent</span><span class=w> </span><span class=kn>import</span> <span class=n>AITrustAgent</span>
<a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=kn>from</span><span class=w> </span><span class=nn>..blockchain.services</span><span class=w> </span><span class=kn>import</span> <span class=n>BlockchainService</span>
<a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>
<a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=k>class</span><span class=w> </span><span class=nc>CampaignService</span><span class=p>:</span>
<a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Service for handling email campaigns with blockchain verification.&quot;&quot;&quot;</span>
<a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a>
<a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>settings</span><span class=p>:</span> <span class=n>Settings</span><span class=p>):</span>
<a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Initialize the campaign service.&quot;&quot;&quot;</span>
<a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a>        <span class=bp>self</span><span class=o>.</span><span class=n>settings</span> <span class=o>=</span> <span class=n>settings</span>
<a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a>        <span class=bp>self</span><span class=o>.</span><span class=n>blockchain_service</span> <span class=o>=</span> <span class=n>BlockchainService</span><span class=p>(</span><span class=n>settings</span><span class=p>)</span>
<a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a>        <span class=bp>self</span><span class=o>.</span><span class=n>ai_trust_agent</span> <span class=o>=</span> <span class=n>AITrustAgent</span><span class=p>(</span><span class=n>settings</span><span class=p>)</span>
<a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a>
<a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>create_campaign</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>campaign_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create a new campaign.&quot;&quot;&quot;</span>
<a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a>        <span class=c1># Basic campaign creation logic</span>
<a id=__codelineno-3-22 name=__codelineno-3-22 href=#__codelineno-3-22></a>        <span class=c1># ...existing code...</span>
<a id=__codelineno-3-23 name=__codelineno-3-23 href=#__codelineno-3-23></a>
<a id=__codelineno-3-24 name=__codelineno-3-24 href=#__codelineno-3-24></a>        <span class=c1># Add blockchain fields</span>
<a id=__codelineno-3-25 name=__codelineno-3-25 href=#__codelineno-3-25></a>        <span class=n>blockchain_enabled</span> <span class=o>=</span> <span class=n>campaign_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;blockchain_enabled&#39;</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-3-26 name=__codelineno-3-26 href=#__codelineno-3-26></a>
<a id=__codelineno-3-27 name=__codelineno-3-27 href=#__codelineno-3-27></a>        <span class=c1># Create campaign in database</span>
<a id=__codelineno-3-28 name=__codelineno-3-28 href=#__codelineno-3-28></a>        <span class=n>campaign</span> <span class=o>=</span> <span class=n>Campaign</span><span class=p>(</span>
<a id=__codelineno-3-29 name=__codelineno-3-29 href=#__codelineno-3-29></a>            <span class=n>user_id</span><span class=o>=</span><span class=n>user_id</span><span class=p>,</span>
<a id=__codelineno-3-30 name=__codelineno-3-30 href=#__codelineno-3-30></a>            <span class=n>task</span><span class=o>=</span><span class=n>campaign_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;task&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>),</span>
<a id=__codelineno-3-31 name=__codelineno-3-31 href=#__codelineno-3-31></a>            <span class=n>status</span><span class=o>=</span><span class=s1>&#39;draft&#39;</span><span class=p>,</span>
<a id=__codelineno-3-32 name=__codelineno-3-32 href=#__codelineno-3-32></a>            <span class=n>subject</span><span class=o>=</span><span class=n>campaign_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;subject&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>),</span>
<a id=__codelineno-3-33 name=__codelineno-3-33 href=#__codelineno-3-33></a>            <span class=n>body</span><span class=o>=</span><span class=n>campaign_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;body&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>),</span>
<a id=__codelineno-3-34 name=__codelineno-3-34 href=#__codelineno-3-34></a>            <span class=n>blockchain_enabled</span><span class=o>=</span><span class=n>blockchain_enabled</span><span class=p>,</span>
<a id=__codelineno-3-35 name=__codelineno-3-35 href=#__codelineno-3-35></a>            <span class=c1># other fields...</span>
<a id=__codelineno-3-36 name=__codelineno-3-36 href=#__codelineno-3-36></a>        <span class=p>)</span>
<a id=__codelineno-3-37 name=__codelineno-3-37 href=#__codelineno-3-37></a>
<a id=__codelineno-3-38 name=__codelineno-3-38 href=#__codelineno-3-38></a>        <span class=c1># Save to database (pseudo-code)</span>
<a id=__codelineno-3-39 name=__codelineno-3-39 href=#__codelineno-3-39></a>        <span class=c1># await db.add(campaign)</span>
<a id=__codelineno-3-40 name=__codelineno-3-40 href=#__codelineno-3-40></a>        <span class=c1># await db.commit()</span>
<a id=__codelineno-3-41 name=__codelineno-3-41 href=#__codelineno-3-41></a>        <span class=c1># await db.refresh(campaign)</span>
<a id=__codelineno-3-42 name=__codelineno-3-42 href=#__codelineno-3-42></a>
<a id=__codelineno-3-43 name=__codelineno-3-43 href=#__codelineno-3-43></a>        <span class=c1># For now, just mock the ID</span>
<a id=__codelineno-3-44 name=__codelineno-3-44 href=#__codelineno-3-44></a>        <span class=n>campaign_id</span> <span class=o>=</span> <span class=mi>12345</span>
<a id=__codelineno-3-45 name=__codelineno-3-45 href=#__codelineno-3-45></a>
<a id=__codelineno-3-46 name=__codelineno-3-46 href=#__codelineno-3-46></a>        <span class=k>return</span> <span class=p>{</span>
<a id=__codelineno-3-47 name=__codelineno-3-47 href=#__codelineno-3-47></a>            <span class=s2>&quot;campaign_id&quot;</span><span class=p>:</span> <span class=n>campaign_id</span><span class=p>,</span>
<a id=__codelineno-3-48 name=__codelineno-3-48 href=#__codelineno-3-48></a>            <span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=s2>&quot;draft&quot;</span><span class=p>,</span>
<a id=__codelineno-3-49 name=__codelineno-3-49 href=#__codelineno-3-49></a>            <span class=s2>&quot;blockchain_enabled&quot;</span><span class=p>:</span> <span class=n>blockchain_enabled</span>
<a id=__codelineno-3-50 name=__codelineno-3-50 href=#__codelineno-3-50></a>        <span class=p>}</span>
<a id=__codelineno-3-51 name=__codelineno-3-51 href=#__codelineno-3-51></a>
<a id=__codelineno-3-52 name=__codelineno-3-52 href=#__codelineno-3-52></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>finalize_campaign</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>campaign_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<a id=__codelineno-3-53 name=__codelineno-3-53 href=#__codelineno-3-53></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Finalize a campaign and record metrics on blockchain if enabled.&quot;&quot;&quot;</span>
<a id=__codelineno-3-54 name=__codelineno-3-54 href=#__codelineno-3-54></a>        <span class=c1># Get campaign from database</span>
<a id=__codelineno-3-55 name=__codelineno-3-55 href=#__codelineno-3-55></a>        <span class=c1># campaign = await db.get(Campaign, campaign_id)</span>
<a id=__codelineno-3-56 name=__codelineno-3-56 href=#__codelineno-3-56></a>        <span class=c1># For now, mock the campaign</span>
<a id=__codelineno-3-57 name=__codelineno-3-57 href=#__codelineno-3-57></a>        <span class=n>campaign</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-3-58 name=__codelineno-3-58 href=#__codelineno-3-58></a>            <span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=n>campaign_id</span><span class=p>,</span>
<a id=__codelineno-3-59 name=__codelineno-3-59 href=#__codelineno-3-59></a>            <span class=s2>&quot;user_id&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
<a id=__codelineno-3-60 name=__codelineno-3-60 href=#__codelineno-3-60></a>            <span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=s2>&quot;sent&quot;</span><span class=p>,</span>
<a id=__codelineno-3-61 name=__codelineno-3-61 href=#__codelineno-3-61></a>            <span class=s2>&quot;blockchain_enabled&quot;</span><span class=p>:</span> <span class=kc>True</span>
<a id=__codelineno-3-62 name=__codelineno-3-62 href=#__codelineno-3-62></a>        <span class=p>}</span>
<a id=__codelineno-3-63 name=__codelineno-3-63 href=#__codelineno-3-63></a>
<a id=__codelineno-3-64 name=__codelineno-3-64 href=#__codelineno-3-64></a>        <span class=c1># Get user/marketer info</span>
<a id=__codelineno-3-65 name=__codelineno-3-65 href=#__codelineno-3-65></a>        <span class=c1># user = await db.get(User, campaign[&quot;user_id&quot;])</span>
<a id=__codelineno-3-66 name=__codelineno-3-66 href=#__codelineno-3-66></a>        <span class=c1># Mock user</span>
<a id=__codelineno-3-67 name=__codelineno-3-67 href=#__codelineno-3-67></a>        <span class=n>user</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-3-68 name=__codelineno-3-68 href=#__codelineno-3-68></a>            <span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
<a id=__codelineno-3-69 name=__codelineno-3-69 href=#__codelineno-3-69></a>            <span class=s2>&quot;wallet_address&quot;</span><span class=p>:</span> <span class=s2>&quot;0x123456789abcdef123456789abcdef123456789a&quot;</span>
<a id=__codelineno-3-70 name=__codelineno-3-70 href=#__codelineno-3-70></a>        <span class=p>}</span>
<a id=__codelineno-3-71 name=__codelineno-3-71 href=#__codelineno-3-71></a>
<a id=__codelineno-3-72 name=__codelineno-3-72 href=#__codelineno-3-72></a>        <span class=c1># Calculate metrics</span>
<a id=__codelineno-3-73 name=__codelineno-3-73 href=#__codelineno-3-73></a>        <span class=n>metrics</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_calculate_metrics</span><span class=p>(</span><span class=n>campaign_id</span><span class=p>)</span>
<a id=__codelineno-3-74 name=__codelineno-3-74 href=#__codelineno-3-74></a>
<a id=__codelineno-3-75 name=__codelineno-3-75 href=#__codelineno-3-75></a>        <span class=c1># Update campaign status</span>
<a id=__codelineno-3-76 name=__codelineno-3-76 href=#__codelineno-3-76></a>        <span class=c1># campaign.status = &quot;completed&quot;</span>
<a id=__codelineno-3-77 name=__codelineno-3-77 href=#__codelineno-3-77></a>        <span class=c1># await db.commit()</span>
<a id=__codelineno-3-78 name=__codelineno-3-78 href=#__codelineno-3-78></a>
<a id=__codelineno-3-79 name=__codelineno-3-79 href=#__codelineno-3-79></a>        <span class=c1># If blockchain verification is enabled, mint tokens and issue certificate</span>
<a id=__codelineno-3-80 name=__codelineno-3-80 href=#__codelineno-3-80></a>        <span class=k>if</span> <span class=n>campaign</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;blockchain_enabled&quot;</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span> <span class=ow>and</span> <span class=n>user</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;wallet_address&quot;</span><span class=p>):</span>
<a id=__codelineno-3-81 name=__codelineno-3-81 href=#__codelineno-3-81></a>            <span class=c1># Mint tokens based on performance</span>
<a id=__codelineno-3-82 name=__codelineno-3-82 href=#__codelineno-3-82></a>            <span class=n>token_result</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>blockchain_service</span><span class=o>.</span><span class=n>mint_tokens_for_campaign</span><span class=p>(</span>
<a id=__codelineno-3-83 name=__codelineno-3-83 href=#__codelineno-3-83></a>                <span class=n>campaign_id</span><span class=o>=</span><span class=n>campaign_id</span><span class=p>,</span>
<a id=__codelineno-3-84 name=__codelineno-3-84 href=#__codelineno-3-84></a>                <span class=n>marketer_address</span><span class=o>=</span><span class=n>user</span><span class=p>[</span><span class=s2>&quot;wallet_address&quot;</span><span class=p>],</span>
<a id=__codelineno-3-85 name=__codelineno-3-85 href=#__codelineno-3-85></a>                <span class=n>metrics</span><span class=o>=</span><span class=n>metrics</span>
<a id=__codelineno-3-86 name=__codelineno-3-86 href=#__codelineno-3-86></a>            <span class=p>)</span>
<a id=__codelineno-3-87 name=__codelineno-3-87 href=#__codelineno-3-87></a>
<a id=__codelineno-3-88 name=__codelineno-3-88 href=#__codelineno-3-88></a>            <span class=c1># Issue trust certificate</span>
<a id=__codelineno-3-89 name=__codelineno-3-89 href=#__codelineno-3-89></a>            <span class=n>certificate_result</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>blockchain_service</span><span class=o>.</span><span class=n>issue_certificate</span><span class=p>(</span>
<a id=__codelineno-3-90 name=__codelineno-3-90 href=#__codelineno-3-90></a>                <span class=n>campaign_id</span><span class=o>=</span><span class=n>campaign_id</span><span class=p>,</span>
<a id=__codelineno-3-91 name=__codelineno-3-91 href=#__codelineno-3-91></a>                <span class=n>marketer_address</span><span class=o>=</span><span class=n>user</span><span class=p>[</span><span class=s2>&quot;wallet_address&quot;</span><span class=p>],</span>
<a id=__codelineno-3-92 name=__codelineno-3-92 href=#__codelineno-3-92></a>                <span class=n>metrics</span><span class=o>=</span><span class=n>metrics</span>
<a id=__codelineno-3-93 name=__codelineno-3-93 href=#__codelineno-3-93></a>            <span class=p>)</span>
<a id=__codelineno-3-94 name=__codelineno-3-94 href=#__codelineno-3-94></a>
<a id=__codelineno-3-95 name=__codelineno-3-95 href=#__codelineno-3-95></a>            <span class=k>return</span> <span class=p>{</span>
<a id=__codelineno-3-96 name=__codelineno-3-96 href=#__codelineno-3-96></a>                <span class=s2>&quot;campaign_id&quot;</span><span class=p>:</span> <span class=n>campaign_id</span><span class=p>,</span>
<a id=__codelineno-3-97 name=__codelineno-3-97 href=#__codelineno-3-97></a>                <span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=s2>&quot;completed&quot;</span><span class=p>,</span>
<a id=__codelineno-3-98 name=__codelineno-3-98 href=#__codelineno-3-98></a>                <span class=s2>&quot;metrics&quot;</span><span class=p>:</span> <span class=n>metrics</span><span class=p>,</span>
<a id=__codelineno-3-99 name=__codelineno-3-99 href=#__codelineno-3-99></a>                <span class=s2>&quot;blockchain&quot;</span><span class=p>:</span> <span class=p>{</span>
<a id=__codelineno-3-100 name=__codelineno-3-100 href=#__codelineno-3-100></a>                    <span class=s2>&quot;verified&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
<a id=__codelineno-3-101 name=__codelineno-3-101 href=#__codelineno-3-101></a>                    <span class=s2>&quot;token_reward&quot;</span><span class=p>:</span> <span class=n>token_result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;token_amount&quot;</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span>
<a id=__codelineno-3-102 name=__codelineno-3-102 href=#__codelineno-3-102></a>                    <span class=s2>&quot;certificate_id&quot;</span><span class=p>:</span> <span class=n>certificate_result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;certificate_id&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>),</span>
<a id=__codelineno-3-103 name=__codelineno-3-103 href=#__codelineno-3-103></a>                    <span class=s2>&quot;transaction_hash&quot;</span><span class=p>:</span> <span class=n>token_result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;transaction_hash&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>),</span>
<a id=__codelineno-3-104 name=__codelineno-3-104 href=#__codelineno-3-104></a>                    <span class=s2>&quot;explorer_url&quot;</span><span class=p>:</span> <span class=n>token_result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;explorer_url&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
<a id=__codelineno-3-105 name=__codelineno-3-105 href=#__codelineno-3-105></a>                <span class=p>}</span>
<a id=__codelineno-3-106 name=__codelineno-3-106 href=#__codelineno-3-106></a>            <span class=p>}</span>
<a id=__codelineno-3-107 name=__codelineno-3-107 href=#__codelineno-3-107></a>        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-3-108 name=__codelineno-3-108 href=#__codelineno-3-108></a>            <span class=k>return</span> <span class=p>{</span>
<a id=__codelineno-3-109 name=__codelineno-3-109 href=#__codelineno-3-109></a>                <span class=s2>&quot;campaign_id&quot;</span><span class=p>:</span> <span class=n>campaign_id</span><span class=p>,</span>
<a id=__codelineno-3-110 name=__codelineno-3-110 href=#__codelineno-3-110></a>                <span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=s2>&quot;completed&quot;</span><span class=p>,</span>
<a id=__codelineno-3-111 name=__codelineno-3-111 href=#__codelineno-3-111></a>                <span class=s2>&quot;metrics&quot;</span><span class=p>:</span> <span class=n>metrics</span><span class=p>,</span>
<a id=__codelineno-3-112 name=__codelineno-3-112 href=#__codelineno-3-112></a>                <span class=s2>&quot;blockchain&quot;</span><span class=p>:</span> <span class=p>{</span>
<a id=__codelineno-3-113 name=__codelineno-3-113 href=#__codelineno-3-113></a>                    <span class=s2>&quot;verified&quot;</span><span class=p>:</span> <span class=kc>False</span>
<a id=__codelineno-3-114 name=__codelineno-3-114 href=#__codelineno-3-114></a>                <span class=p>}</span>
<a id=__codelineno-3-115 name=__codelineno-3-115 href=#__codelineno-3-115></a>            <span class=p>}</span>
<a id=__codelineno-3-116 name=__codelineno-3-116 href=#__codelineno-3-116></a>
<a id=__codelineno-3-117 name=__codelineno-3-117 href=#__codelineno-3-117></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>_calculate_metrics</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>campaign_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<a id=__codelineno-3-118 name=__codelineno-3-118 href=#__codelineno-3-118></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Calculate campaign metrics.&quot;&quot;&quot;</span>
<a id=__codelineno-3-119 name=__codelineno-3-119 href=#__codelineno-3-119></a>        <span class=c1># In a real implementation, fetch metrics from database</span>
<a id=__codelineno-3-120 name=__codelineno-3-120 href=#__codelineno-3-120></a>        <span class=c1># For now, return mock metrics</span>
<a id=__codelineno-3-121 name=__codelineno-3-121 href=#__codelineno-3-121></a>        <span class=k>return</span> <span class=p>{</span>
<a id=__codelineno-3-122 name=__codelineno-3-122 href=#__codelineno-3-122></a>            <span class=s2>&quot;sent&quot;</span><span class=p>:</span> <span class=mi>1000</span><span class=p>,</span>
<a id=__codelineno-3-123 name=__codelineno-3-123 href=#__codelineno-3-123></a>            <span class=s2>&quot;delivered&quot;</span><span class=p>:</span> <span class=mi>950</span><span class=p>,</span>
<a id=__codelineno-3-124 name=__codelineno-3-124 href=#__codelineno-3-124></a>            <span class=s2>&quot;opened&quot;</span><span class=p>:</span> <span class=mi>380</span><span class=p>,</span>
<a id=__codelineno-3-125 name=__codelineno-3-125 href=#__codelineno-3-125></a>            <span class=s2>&quot;clicked&quot;</span><span class=p>:</span> <span class=mi>114</span><span class=p>,</span>
<a id=__codelineno-3-126 name=__codelineno-3-126 href=#__codelineno-3-126></a>            <span class=s2>&quot;bounced&quot;</span><span class=p>:</span> <span class=mi>50</span><span class=p>,</span>
<a id=__codelineno-3-127 name=__codelineno-3-127 href=#__codelineno-3-127></a>            <span class=s2>&quot;unsubscribed&quot;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>
<a id=__codelineno-3-128 name=__codelineno-3-128 href=#__codelineno-3-128></a>            <span class=s2>&quot;open_rate&quot;</span><span class=p>:</span> <span class=mf>0.4</span><span class=p>,</span>  <span class=c1># 40%</span>
<a id=__codelineno-3-129 name=__codelineno-3-129 href=#__codelineno-3-129></a>            <span class=s2>&quot;click_rate&quot;</span><span class=p>:</span> <span class=mf>0.12</span><span class=p>,</span>  <span class=c1># 12%</span>
<a id=__codelineno-3-130 name=__codelineno-3-130 href=#__codelineno-3-130></a>            <span class=s2>&quot;bounce_rate&quot;</span><span class=p>:</span> <span class=mf>0.05</span><span class=p>,</span>  <span class=c1># 5%</span>
<a id=__codelineno-3-131 name=__codelineno-3-131 href=#__codelineno-3-131></a>            <span class=s2>&quot;unsubscribe_rate&quot;</span><span class=p>:</span> <span class=mf>0.005</span>  <span class=c1># 0.5%</span>
<a id=__codelineno-3-132 name=__codelineno-3-132 href=#__codelineno-3-132></a>        <span class=p>}</span>
</code></pre></div> <h4 id=database-schema-updates>Database Schema Updates<a class=headerlink href=#database-schema-updates title="Permanent link">&para;</a></h4> <p>Add these blockchain-related models to the existing database schema:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=c1># apps/api/models/blockchain.py</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=kn>from</span><span class=w> </span><span class=nn>datetime</span><span class=w> </span><span class=kn>import</span> <span class=n>datetime</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=kn>from</span><span class=w> </span><span class=nn>sqlalchemy</span><span class=w> </span><span class=kn>import</span> <span class=n>Boolean</span><span class=p>,</span> <span class=n>Column</span><span class=p>,</span> <span class=n>DateTime</span><span class=p>,</span> <span class=n>ForeignKey</span><span class=p>,</span> <span class=n>Integer</span><span class=p>,</span> <span class=n>String</span><span class=p>,</span> <span class=n>Text</span><span class=p>,</span> <span class=n>Float</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=kn>from</span><span class=w> </span><span class=nn>sqlalchemy.ext.declarative</span><span class=w> </span><span class=kn>import</span> <span class=n>declarative_base</span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=kn>from</span><span class=w> </span><span class=nn>sqlalchemy.orm</span><span class=w> </span><span class=kn>import</span> <span class=n>relationship</span>
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=n>Base</span> <span class=o>=</span> <span class=n>declarative_base</span><span class=p>()</span>
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=k>class</span><span class=w> </span><span class=nc>WalletAddress</span><span class=p>(</span><span class=n>Base</span><span class=p>):</span>
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Blockchain wallet address model.&quot;&quot;&quot;</span>
<a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>    <span class=n>__tablename__</span> <span class=o>=</span> <span class=s2>&quot;wallet_addresses&quot;</span>
<a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a>
<a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a>    <span class=nb>id</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>primary_key</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a>    <span class=n>user_id</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>ForeignKey</span><span class=p>(</span><span class=s2>&quot;users.id&quot;</span><span class=p>),</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a>    <span class=n>address</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>,</span> <span class=n>unique</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a>    <span class=n>chain_id</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># 1 = Ethereum Mainnet</span>
<a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a>    <span class=n>is_primary</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Boolean</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a>    <span class=n>created_at</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>DateTime</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>)</span>
<a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a>
<a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a>    <span class=c1># Relationships</span>
<a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a>    <span class=n>user</span> <span class=o>=</span> <span class=n>relationship</span><span class=p>(</span><span class=s2>&quot;User&quot;</span><span class=p>,</span> <span class=n>back_populates</span><span class=o>=</span><span class=s2>&quot;wallet_addresses&quot;</span><span class=p>)</span>
<a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a>    <span class=n>token_balances</span> <span class=o>=</span> <span class=n>relationship</span><span class=p>(</span><span class=s2>&quot;TokenBalance&quot;</span><span class=p>,</span> <span class=n>back_populates</span><span class=o>=</span><span class=s2>&quot;wallet_address&quot;</span><span class=p>)</span>
<a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a>
<a id=__codelineno-4-24 name=__codelineno-4-24 href=#__codelineno-4-24></a><span class=k>class</span><span class=w> </span><span class=nc>TokenBalance</span><span class=p>(</span><span class=n>Base</span><span class=p>):</span>
<a id=__codelineno-4-25 name=__codelineno-4-25 href=#__codelineno-4-25></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Token balance model.&quot;&quot;&quot;</span>
<a id=__codelineno-4-26 name=__codelineno-4-26 href=#__codelineno-4-26></a>    <span class=n>__tablename__</span> <span class=o>=</span> <span class=s2>&quot;token_balances&quot;</span>
<a id=__codelineno-4-27 name=__codelineno-4-27 href=#__codelineno-4-27></a>
<a id=__codelineno-4-28 name=__codelineno-4-28 href=#__codelineno-4-28></a>    <span class=nb>id</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>primary_key</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-4-29 name=__codelineno-4-29 href=#__codelineno-4-29></a>    <span class=n>wallet_address_id</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>ForeignKey</span><span class=p>(</span><span class=s2>&quot;wallet_addresses.id&quot;</span><span class=p>),</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-4-30 name=__codelineno-4-30 href=#__codelineno-4-30></a>    <span class=n>token_address</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-4-31 name=__codelineno-4-31 href=#__codelineno-4-31></a>    <span class=n>balance</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>  <span class=c1># Store as string to handle large numbers</span>
<a id=__codelineno-4-32 name=__codelineno-4-32 href=#__codelineno-4-32></a>    <span class=n>chain_id</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
<a id=__codelineno-4-33 name=__codelineno-4-33 href=#__codelineno-4-33></a>    <span class=n>last_updated</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>DateTime</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>,</span> <span class=n>onupdate</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>)</span>
<a id=__codelineno-4-34 name=__codelineno-4-34 href=#__codelineno-4-34></a>
<a id=__codelineno-4-35 name=__codelineno-4-35 href=#__codelineno-4-35></a>    <span class=c1># Relationships</span>
<a id=__codelineno-4-36 name=__codelineno-4-36 href=#__codelineno-4-36></a>    <span class=n>wallet_address</span> <span class=o>=</span> <span class=n>relationship</span><span class=p>(</span><span class=s2>&quot;WalletAddress&quot;</span><span class=p>,</span> <span class=n>back_populates</span><span class=o>=</span><span class=s2>&quot;token_balances&quot;</span><span class=p>)</span>
<a id=__codelineno-4-37 name=__codelineno-4-37 href=#__codelineno-4-37></a>
<a id=__codelineno-4-38 name=__codelineno-4-38 href=#__codelineno-4-38></a><span class=k>class</span><span class=w> </span><span class=nc>TrustCertificate</span><span class=p>(</span><span class=n>Base</span><span class=p>):</span>
<a id=__codelineno-4-39 name=__codelineno-4-39 href=#__codelineno-4-39></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Trust certificate model.&quot;&quot;&quot;</span>
<a id=__codelineno-4-40 name=__codelineno-4-40 href=#__codelineno-4-40></a>    <span class=n>__tablename__</span> <span class=o>=</span> <span class=s2>&quot;trust_certificates&quot;</span>
<a id=__codelineno-4-41 name=__codelineno-4-41 href=#__codelineno-4-41></a>
<a id=__codelineno-4-42 name=__codelineno-4-42 href=#__codelineno-4-42></a>    <span class=nb>id</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>primary_key</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-4-43 name=__codelineno-4-43 href=#__codelineno-4-43></a>    <span class=n>certificate_id</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>,</span> <span class=n>unique</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-4-44 name=__codelineno-4-44 href=#__codelineno-4-44></a>    <span class=n>campaign_id</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>ForeignKey</span><span class=p>(</span><span class=s2>&quot;campaigns.id&quot;</span><span class=p>),</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-4-45 name=__codelineno-4-45 href=#__codelineno-4-45></a>    <span class=n>user_id</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>ForeignKey</span><span class=p>(</span><span class=s2>&quot;users.id&quot;</span><span class=p>),</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-4-46 name=__codelineno-4-46 href=#__codelineno-4-46></a>    <span class=n>metrics_hash</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-4-47 name=__codelineno-4-47 href=#__codelineno-4-47></a>    <span class=n>transaction_hash</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-4-48 name=__codelineno-4-48 href=#__codelineno-4-48></a>    <span class=n>blockchain_verified</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Boolean</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-4-49 name=__codelineno-4-49 href=#__codelineno-4-49></a>    <span class=n>created_at</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>DateTime</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>)</span>
<a id=__codelineno-4-50 name=__codelineno-4-50 href=#__codelineno-4-50></a>
<a id=__codelineno-4-51 name=__codelineno-4-51 href=#__codelineno-4-51></a>    <span class=c1># Relationships</span>
<a id=__codelineno-4-52 name=__codelineno-4-52 href=#__codelineno-4-52></a>    <span class=n>campaign</span> <span class=o>=</span> <span class=n>relationship</span><span class=p>(</span><span class=s2>&quot;Campaign&quot;</span><span class=p>,</span> <span class=n>back_populates</span><span class=o>=</span><span class=s2>&quot;certificate&quot;</span><span class=p>)</span>
<a id=__codelineno-4-53 name=__codelineno-4-53 href=#__codelineno-4-53></a>    <span class=n>user</span> <span class=o>=</span> <span class=n>relationship</span><span class=p>(</span><span class=s2>&quot;User&quot;</span><span class=p>,</span> <span class=n>back_populates</span><span class=o>=</span><span class=s2>&quot;certificates&quot;</span><span class=p>)</span>
<a id=__codelineno-4-54 name=__codelineno-4-54 href=#__codelineno-4-54></a>
<a id=__codelineno-4-55 name=__codelineno-4-55 href=#__codelineno-4-55></a><span class=k>class</span><span class=w> </span><span class=nc>BlockchainEvent</span><span class=p>(</span><span class=n>Base</span><span class=p>):</span>
<a id=__codelineno-4-56 name=__codelineno-4-56 href=#__codelineno-4-56></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Blockchain event model for tracking contract events.&quot;&quot;&quot;</span>
<a id=__codelineno-4-57 name=__codelineno-4-57 href=#__codelineno-4-57></a>    <span class=n>__tablename__</span> <span class=o>=</span> <span class=s2>&quot;blockchain_events&quot;</span>
<a id=__codelineno-4-58 name=__codelineno-4-58 href=#__codelineno-4-58></a>
<a id=__codelineno-4-59 name=__codelineno-4-59 href=#__codelineno-4-59></a>    <span class=nb>id</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>primary_key</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-4-60 name=__codelineno-4-60 href=#__codelineno-4-60></a>    <span class=n>transaction_hash</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-4-61 name=__codelineno-4-61 href=#__codelineno-4-61></a>    <span class=n>block_number</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-4-62 name=__codelineno-4-62 href=#__codelineno-4-62></a>    <span class=n>event_name</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-4-63 name=__codelineno-4-63 href=#__codelineno-4-63></a>    <span class=n>contract_address</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-4-64 name=__codelineno-4-64 href=#__codelineno-4-64></a>    <span class=n>parameters</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Text</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>  <span class=c1># JSON string</span>
<a id=__codelineno-4-65 name=__codelineno-4-65 href=#__codelineno-4-65></a>    <span class=n>created_at</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>DateTime</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>)</span>
</code></pre></div> <p>Also update the User and Campaign models:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=c1># Additions to apps/api/models/user.py</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=k>class</span><span class=w> </span><span class=nc>User</span><span class=p>(</span><span class=n>Base</span><span class=p>):</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>    <span class=c1># Other fields...</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>    <span class=c1># Blockchain fields</span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>    <span class=n>wallet_addresses</span> <span class=o>=</span> <span class=n>relationship</span><span class=p>(</span><span class=s2>&quot;WalletAddress&quot;</span><span class=p>,</span> <span class=n>back_populates</span><span class=o>=</span><span class=s2>&quot;user&quot;</span><span class=p>)</span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>    <span class=n>certificates</span> <span class=o>=</span> <span class=n>relationship</span><span class=p>(</span><span class=s2>&quot;TrustCertificate&quot;</span><span class=p>,</span> <span class=n>back_populates</span><span class=o>=</span><span class=s2>&quot;user&quot;</span><span class=p>)</span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a>    <span class=n>trust_rank</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=s2>&quot;Bronze&quot;</span><span class=p>)</span>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a>    <span class=n>trust_score</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a>
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=c1># Additions to apps/api/models/campaign.py</span>
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=k>class</span><span class=w> </span><span class=nc>Campaign</span><span class=p>(</span><span class=n>Base</span><span class=p>):</span>
<a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a>    <span class=c1># Other fields...</span>
<a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a>
<a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a>    <span class=c1># Blockchain fields</span>
<a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a>    <span class=n>blockchain_enabled</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Boolean</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a>    <span class=n>certificate</span> <span class=o>=</span> <span class=n>relationship</span><span class=p>(</span><span class=s2>&quot;TrustCertificate&quot;</span><span class=p>,</span> <span class=n>back_populates</span><span class=o>=</span><span class=s2>&quot;campaign&quot;</span><span class=p>,</span> <span class=n>uselist</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a>    <span class=n>token_reward</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Float</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
<a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a>    <span class=n>trust_score</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</code></pre></div> <h4 id=deployment-configuration-for-blockchain-infrastructure>Deployment Configuration for Blockchain Infrastructure<a class=headerlink href=#deployment-configuration-for-blockchain-infrastructure title="Permanent link">&para;</a></h4> <p>Create a Terraform module for the blockchain infrastructure:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=c1># infrastructure/terraform/modules/blockchain/main.tf</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=c1># Key Management Service for secure key storage</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;aws_kms_key&quot;</span><span class=w> </span><span class=nv>&quot;blockchain_key&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=w>  </span><span class=na>description</span><span class=w>             </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Blockchain signing key for Maily&quot;</span>
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=w>  </span><span class=na>deletion_window_in_days</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>10</span>
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=w>  </span><span class=na>enable_key_rotation</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=w>  </span><span class=nb>tags</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=w>    </span><span class=na>Name</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;maily-blockchain-key&quot;</span>
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=w>    </span><span class=na>Environment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span>
<a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=p>}</span>
<a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a>
<a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a><span class=c1># Lambda function for blockchain operations</span>
<a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;aws_lambda_function&quot;</span><span class=w> </span><span class=nv>&quot;blockchain_service&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a><span class=w>  </span><span class=na>function_name</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;maily-blockchain-service-${var.environment}&quot;</span>
<a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a><span class=w>  </span><span class=na>handler</span><span class=w>          </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;index.handler&quot;</span>
<a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a><span class=w>  </span><span class=na>runtime</span><span class=w>          </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;nodejs18.x&quot;</span>
<a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a><span class=w>  </span><span class=na>role</span><span class=w>             </span><span class=o>=</span><span class=w> </span><span class=nv>aws_iam_role.lambda_role.arn</span>
<a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a><span class=w>  </span><span class=na>filename</span><span class=w>         </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;${path.module}/lambda/blockchain-service.zip&quot;</span>
<a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a><span class=w>  </span><span class=na>source_code_hash</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>filebase64sha256</span><span class=p>(</span><span class=s2>&quot;${path.module}/lambda/blockchain-service.zip&quot;</span><span class=p>)</span>
<a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a><span class=w>  </span><span class=na>timeout</span><span class=w>          </span><span class=o>=</span><span class=w> </span><span class=m>30</span>
<a id=__codelineno-6-23 name=__codelineno-6-23 href=#__codelineno-6-23></a><span class=w>  </span><span class=na>memory_size</span><span class=w>      </span><span class=o>=</span><span class=w> </span><span class=m>1024</span>
<a id=__codelineno-6-24 name=__codelineno-6-24 href=#__codelineno-6-24></a>
<a id=__codelineno-6-25 name=__codelineno-6-25 href=#__codelineno-6-25></a><span class=w>  </span><span class=nb>environment</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-26 name=__codelineno-6-26 href=#__codelineno-6-26></a><span class=w>    </span><span class=nb>variables</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-27 name=__codelineno-6-27 href=#__codelineno-6-27></a><span class=w>      </span><span class=na>ETHEREUM_RPC_URL</span><span class=w>       </span><span class=o>=</span><span class=w> </span><span class=nv>var.ethereum_rpc_url</span>
<a id=__codelineno-6-28 name=__codelineno-6-28 href=#__codelineno-6-28></a><span class=w>      </span><span class=na>ETHEREUM_CHAIN_ID</span><span class=w>      </span><span class=o>=</span><span class=w> </span><span class=nv>var.ethereum_chain_id</span>
<a id=__codelineno-6-29 name=__codelineno-6-29 href=#__codelineno-6-29></a><span class=w>      </span><span class=na>POLYGON_RPC_URL</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=nv>var.polygon_rpc_url</span>
<a id=__codelineno-6-30 name=__codelineno-6-30 href=#__codelineno-6-30></a><span class=w>      </span><span class=na>POLYGON_CHAIN_ID</span><span class=w>       </span><span class=o>=</span><span class=w> </span><span class=nv>var.polygon_chain_id</span>
<a id=__codelineno-6-31 name=__codelineno-6-31 href=#__codelineno-6-31></a><span class=w>      </span><span class=na>ZKSYNC_RPC_URL</span><span class=w>         </span><span class=o>=</span><span class=w> </span><span class=nv>var.zksync_rpc_url</span>
<a id=__codelineno-6-32 name=__codelineno-6-32 href=#__codelineno-6-32></a><span class=w>      </span><span class=na>ZKSYNC_CHAIN_ID</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=nv>var.zksync_chain_id</span>
<a id=__codelineno-6-33 name=__codelineno-6-33 href=#__codelineno-6-33></a><span class=w>      </span><span class=na>MAILY_TOKEN_ADDRESS</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=nv>var.maily_token_address</span>
<a id=__codelineno-6-34 name=__codelineno-6-34 href=#__codelineno-6-34></a><span class=w>      </span><span class=na>TRUST_CERT_ADDRESS</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=nv>var.trust_certificate_address</span>
<a id=__codelineno-6-35 name=__codelineno-6-35 href=#__codelineno-6-35></a><span class=w>      </span><span class=na>KMS_KEY_ID</span><span class=w>             </span><span class=o>=</span><span class=w> </span><span class=nv>aws_kms_key.blockchain_key.id</span>
<a id=__codelineno-6-36 name=__codelineno-6-36 href=#__codelineno-6-36></a><span class=w>      </span><span class=na>BLOCK_EXPLORER_URL</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=nv>var.block_explorer_url</span>
<a id=__codelineno-6-37 name=__codelineno-6-37 href=#__codelineno-6-37></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-6-38 name=__codelineno-6-38 href=#__codelineno-6-38></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-6-39 name=__codelineno-6-39 href=#__codelineno-6-39></a><span class=p>}</span>
<a id=__codelineno-6-40 name=__codelineno-6-40 href=#__codelineno-6-40></a>
<a id=__codelineno-6-41 name=__codelineno-6-41 href=#__codelineno-6-41></a><span class=c1># API Gateway for blockchain operations</span>
<a id=__codelineno-6-42 name=__codelineno-6-42 href=#__codelineno-6-42></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;aws_api_gateway_rest_api&quot;</span><span class=w> </span><span class=nv>&quot;blockchain_api&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-43 name=__codelineno-6-43 href=#__codelineno-6-43></a><span class=w>  </span><span class=na>name</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;maily-blockchain-api-${var.environment}&quot;</span>
<a id=__codelineno-6-44 name=__codelineno-6-44 href=#__codelineno-6-44></a><span class=w>  </span><span class=na>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;API for Maily blockchain operations&quot;</span>
<a id=__codelineno-6-45 name=__codelineno-6-45 href=#__codelineno-6-45></a><span class=p>}</span>
<a id=__codelineno-6-46 name=__codelineno-6-46 href=#__codelineno-6-46></a>
<a id=__codelineno-6-47 name=__codelineno-6-47 href=#__codelineno-6-47></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;aws_api_gateway_resource&quot;</span><span class=w> </span><span class=nv>&quot;blockchain&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-48 name=__codelineno-6-48 href=#__codelineno-6-48></a><span class=w>  </span><span class=na>rest_api_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>aws_api_gateway_rest_api.blockchain_api.id</span>
<a id=__codelineno-6-49 name=__codelineno-6-49 href=#__codelineno-6-49></a><span class=w>  </span><span class=na>parent_id</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=nv>aws_api_gateway_rest_api.blockchain_api.root_resource_id</span>
<a id=__codelineno-6-50 name=__codelineno-6-50 href=#__codelineno-6-50></a><span class=w>  </span><span class=na>path_part</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;blockchain&quot;</span>
<a id=__codelineno-6-51 name=__codelineno-6-51 href=#__codelineno-6-51></a><span class=p>}</span>
<a id=__codelineno-6-52 name=__codelineno-6-52 href=#__codelineno-6-52></a>
<a id=__codelineno-6-53 name=__codelineno-6-53 href=#__codelineno-6-53></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;aws_api_gateway_method&quot;</span><span class=w> </span><span class=nv>&quot;blockchain_post&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-54 name=__codelineno-6-54 href=#__codelineno-6-54></a><span class=w>  </span><span class=na>rest_api_id</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=nv>aws_api_gateway_rest_api.blockchain_api.id</span>
<a id=__codelineno-6-55 name=__codelineno-6-55 href=#__codelineno-6-55></a><span class=w>  </span><span class=na>resource_id</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=nv>aws_api_gateway_resource.blockchain.id</span>
<a id=__codelineno-6-56 name=__codelineno-6-56 href=#__codelineno-6-56></a><span class=w>  </span><span class=na>http_method</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;POST&quot;</span>
<a id=__codelineno-6-57 name=__codelineno-6-57 href=#__codelineno-6-57></a><span class=w>  </span><span class=na>authorization_type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;CUSTOM&quot;</span>
<a id=__codelineno-6-58 name=__codelineno-6-58 href=#__codelineno-6-58></a><span class=w>  </span><span class=na>authorizer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>aws_api_gateway_authorizer.token_authorizer.id</span>
<a id=__codelineno-6-59 name=__codelineno-6-59 href=#__codelineno-6-59></a><span class=p>}</span>
<a id=__codelineno-6-60 name=__codelineno-6-60 href=#__codelineno-6-60></a>
<a id=__codelineno-6-61 name=__codelineno-6-61 href=#__codelineno-6-61></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;aws_api_gateway_integration&quot;</span><span class=w> </span><span class=nv>&quot;lambda_integration&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-62 name=__codelineno-6-62 href=#__codelineno-6-62></a><span class=w>  </span><span class=na>rest_api_id</span><span class=w>             </span><span class=o>=</span><span class=w> </span><span class=nv>aws_api_gateway_rest_api.blockchain_api.id</span>
<a id=__codelineno-6-63 name=__codelineno-6-63 href=#__codelineno-6-63></a><span class=w>  </span><span class=na>resource_id</span><span class=w>             </span><span class=o>=</span><span class=w> </span><span class=nv>aws_api_gateway_resource.blockchain.id</span>
<a id=__codelineno-6-64 name=__codelineno-6-64 href=#__codelineno-6-64></a><span class=w>  </span><span class=na>http_method</span><span class=w>             </span><span class=o>=</span><span class=w> </span><span class=nv>aws_api_gateway_method.blockchain_post.http_method</span>
<a id=__codelineno-6-65 name=__codelineno-6-65 href=#__codelineno-6-65></a><span class=w>  </span><span class=na>integration_http_method</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;POST&quot;</span>
<a id=__codelineno-6-66 name=__codelineno-6-66 href=#__codelineno-6-66></a><span class=w>  </span><span class=na>type</span><span class=w>                    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;AWS_PROXY&quot;</span>
<a id=__codelineno-6-67 name=__codelineno-6-67 href=#__codelineno-6-67></a><span class=w>  </span><span class=na>uri</span><span class=w>                     </span><span class=o>=</span><span class=w> </span><span class=nv>aws_lambda_function.blockchain_service.invoke_arn</span>
<a id=__codelineno-6-68 name=__codelineno-6-68 href=#__codelineno-6-68></a><span class=p>}</span>
<a id=__codelineno-6-69 name=__codelineno-6-69 href=#__codelineno-6-69></a>
<a id=__codelineno-6-70 name=__codelineno-6-70 href=#__codelineno-6-70></a><span class=c1># Chainlink External Adapter for email metrics</span>
<a id=__codelineno-6-71 name=__codelineno-6-71 href=#__codelineno-6-71></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;aws_lambda_function&quot;</span><span class=w> </span><span class=nv>&quot;chainlink_adapter&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-72 name=__codelineno-6-72 href=#__codelineno-6-72></a><span class=w>  </span><span class=na>function_name</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;maily-chainlink-adapter-${var.environment}&quot;</span>
<a id=__codelineno-6-73 name=__codelineno-6-73 href=#__codelineno-6-73></a><span class=w>  </span><span class=na>handler</span><span class=w>          </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;index.handler&quot;</span>
<a id=__codelineno-6-74 name=__codelineno-6-74 href=#__codelineno-6-74></a><span class=w>  </span><span class=na>runtime</span><span class=w>          </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;nodejs18.x&quot;</span>
<a id=__codelineno-6-75 name=__codelineno-6-75 href=#__codelineno-6-75></a><span class=w>  </span><span class=na>role</span><span class=w>             </span><span class=o>=</span><span class=w> </span><span class=nv>aws_iam_role.lambda_role.arn</span>
<a id=__codelineno-6-76 name=__codelineno-6-76 href=#__codelineno-6-76></a><span class=w>  </span><span class=na>filename</span><span class=w>         </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;${path.module}/lambda/chainlink-adapter.zip&quot;</span>
<a id=__codelineno-6-77 name=__codelineno-6-77 href=#__codelineno-6-77></a><span class=w>  </span><span class=na>source_code_hash</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>filebase64sha256</span><span class=p>(</span><span class=s2>&quot;${path.module}/lambda/chainlink-adapter.zip&quot;</span><span class=p>)</span>
<a id=__codelineno-6-78 name=__codelineno-6-78 href=#__codelineno-6-78></a><span class=w>  </span><span class=na>timeout</span><span class=w>          </span><span class=o>=</span><span class=w> </span><span class=m>60</span>
<a id=__codelineno-6-79 name=__codelineno-6-79 href=#__codelineno-6-79></a><span class=w>  </span><span class=na>memory_size</span><span class=w>      </span><span class=o>=</span><span class=w> </span><span class=m>256</span>
<a id=__codelineno-6-80 name=__codelineno-6-80 href=#__codelineno-6-80></a>
<a id=__codelineno-6-81 name=__codelineno-6-81 href=#__codelineno-6-81></a><span class=w>  </span><span class=nb>environment</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-82 name=__codelineno-6-82 href=#__codelineno-6-82></a><span class=w>    </span><span class=nb>variables</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-83 name=__codelineno-6-83 href=#__codelineno-6-83></a><span class=w>      </span><span class=na>MAILY_API_URL</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.maily_api_url</span>
<a id=__codelineno-6-84 name=__codelineno-6-84 href=#__codelineno-6-84></a><span class=w>      </span><span class=na>MAILY_API_KEY</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.maily_api_key</span>
<a id=__codelineno-6-85 name=__codelineno-6-85 href=#__codelineno-6-85></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-6-86 name=__codelineno-6-86 href=#__codelineno-6-86></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-6-87 name=__codelineno-6-87 href=#__codelineno-6-87></a><span class=p>}</span>
<a id=__codelineno-6-88 name=__codelineno-6-88 href=#__codelineno-6-88></a>
<a id=__codelineno-6-89 name=__codelineno-6-89 href=#__codelineno-6-89></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;aws_api_gateway_resource&quot;</span><span class=w> </span><span class=nv>&quot;chainlink&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-90 name=__codelineno-6-90 href=#__codelineno-6-90></a><span class=w>  </span><span class=na>rest_api_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>aws_api_gateway_rest_api.blockchain_api.id</span>
<a id=__codelineno-6-91 name=__codelineno-6-91 href=#__codelineno-6-91></a><span class=w>  </span><span class=na>parent_id</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=nv>aws_api_gateway_rest_api.blockchain_api.root_resource_id</span>
<a id=__codelineno-6-92 name=__codelineno-6-92 href=#__codelineno-6-92></a><span class=w>  </span><span class=na>path_part</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;chainlink&quot;</span>
<a id=__codelineno-6-93 name=__codelineno-6-93 href=#__codelineno-6-93></a><span class=p>}</span>
<a id=__codelineno-6-94 name=__codelineno-6-94 href=#__codelineno-6-94></a>
<a id=__codelineno-6-95 name=__codelineno-6-95 href=#__codelineno-6-95></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;aws_api_gateway_method&quot;</span><span class=w> </span><span class=nv>&quot;chainlink_post&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-96 name=__codelineno-6-96 href=#__codelineno-6-96></a><span class=w>  </span><span class=na>rest_api_id</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=nv>aws_api_gateway_rest_api.blockchain_api.id</span>
<a id=__codelineno-6-97 name=__codelineno-6-97 href=#__codelineno-6-97></a><span class=w>  </span><span class=na>resource_id</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=nv>aws_api_gateway_resource.chainlink.id</span>
<a id=__codelineno-6-98 name=__codelineno-6-98 href=#__codelineno-6-98></a><span class=w>  </span><span class=na>http_method</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;POST&quot;</span>
<a id=__codelineno-6-99 name=__codelineno-6-99 href=#__codelineno-6-99></a><span class=w>  </span><span class=na>authorization_type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;API_KEY&quot;</span>
<a id=__codelineno-6-100 name=__codelineno-6-100 href=#__codelineno-6-100></a><span class=p>}</span>
<a id=__codelineno-6-101 name=__codelineno-6-101 href=#__codelineno-6-101></a>
<a id=__codelineno-6-102 name=__codelineno-6-102 href=#__codelineno-6-102></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;aws_api_gateway_integration&quot;</span><span class=w> </span><span class=nv>&quot;chainlink_integration&quot;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-103 name=__codelineno-6-103 href=#__codelineno-6-103></a><span class=w>  </span><span class=na>rest_api_id</span><span class=w>             </span><span class=o>=</span><span class=w> </span><span class=nv>aws_api_gateway_rest_api.blockchain_api.id</span>
<a id=__codelineno-6-104 name=__codelineno-6-104 href=#__codelineno-6-104></a><span class=w>  </span><span class=na>resource_id</span><span class=w>             </span><span class=o>=</span><span class=w> </span><span class=nv>aws_api_gateway_resource.chainlink.id</span>
<a id=__codelineno-6-105 name=__codelineno-6-105 href=#__codelineno-6-105></a><span class=w>  </span><span class=na>http_method</span><span class=w>             </span><span class=o>=</span><span class=w> </span><span class=nv>aws_api_gateway_method.chainlink_post.http_method</span>
<a id=__codelineno-6-106 name=__codelineno-6-106 href=#__codelineno-6-106></a><span class=w>  </span><span class=na>integration_http_method</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;POST&quot;</span>
<a id=__codelineno-6-107 name=__codelineno-6-107 href=#__codelineno-6-107></a><span class=w>  </span><span class=na>type</span><span class=w>                    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;AWS_PROXY&quot;</span>
<a id=__codelineno-6-108 name=__codelineno-6-108 href=#__codelineno-6-108></a><span class=w>  </span><span class=na>uri</span><span class=w>                     </span><span class=o>=</span><span class=w> </span><span class=nv>aws_lambda_function.chainlink_adapter.invoke_arn</span>
<a id=__codelineno-6-109 name=__codelineno-6-109 href=#__codelineno-6-109></a><span class=p>}</span>
</code></pre></div> <h3 id=2-ai-trust-agents-with-predictive-personalization>2. AI Trust Agents with Predictive Personalization<a class=headerlink href=#2-ai-trust-agents-with-predictive-personalization title="Permanent link">&para;</a></h3> <h4 id=ai-trust-agent-implementation>AI Trust Agent Implementation<a class=headerlink href=#ai-trust-agent-implementation title="Permanent link">&para;</a></h4> <p>Create an advanced AI service for personalization:</p> <p>```python</p> <h1 id=packagesaitrust_agentpy>packages/ai/trust_agent.py<a class=headerlink href=#packagesaitrust_agentpy title="Permanent link">&para;</a></h1> <p>import numpy as np import tensorflow as tf import os import json import logging from typing import Dict, Any, List, Optional from datetime import datetime import langchain from langchain.llms import OpenAI from langchain.prompts import PromptTemplate from langchain.chains import LLMChain from langchain.embeddings import OpenAIEmbeddings from langchain.vectorstores import FAISS</p> <h1 id=configure-logging>Configure logging<a class=headerlink href=#configure-logging title="Permanent link">&para;</a></h1> <p>logger = logging.getLogger(<strong>name</strong>)</p> <p>class PersonalizationModel: """Machine learning model for email personalization."""</p> <div class=codehilite><pre><span></span><code><span class=n>def</span><span class=w> </span><span class=n>__init__</span><span class=p>(</span><span class=n>self</span><span class=p>,</span><span class=w> </span><span class=nl>model_path</span><span class=p>:</span><span class=w> </span><span class=n>Optional</span><span class=o>[</span><span class=n>str</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>None</span><span class=p>)</span><span class=err>:</span>
<span class=w>    </span><span class=ss>&quot;&quot;&quot;Initialize the personalization model.&quot;&quot;&quot;</span>
<span class=w>    </span><span class=n>self</span><span class=p>.</span><span class=n>embeddings</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>OpenAIEmbeddings</span><span class=p>()</span>
<span class=w>    </span><span class=n>self</span><span class=p>.</span><span class=n>model_path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model_path</span><span class=w> </span><span class=ow>or</span><span class=w> </span><span class=ss>&quot;models/personalization&quot;</span>
<span class=w>    </span><span class=n>self</span><span class=p>.</span><span class=n>_load_or_create_model</span><span class=p>()</span>

<span class=n>def</span><span class=w> </span><span class=n>_load_or_create_model</span><span class=p>(</span><span class=n>self</span><span class=p>)</span><span class=err>:</span>
<span class=w>    </span><span class=ss>&quot;&quot;&quot;Load an existing model or create a new one.&quot;&quot;&quot;</span>
<span class=w>    </span><span class=k>try</span><span class=err>:</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=n>os</span><span class=p>.</span><span class=k>path</span><span class=p>.</span><span class=ow>exists</span><span class=p>(</span><span class=n>self</span><span class=p>.</span><span class=n>model_path</span><span class=p>)</span><span class=err>:</span>
<span class=w>            </span><span class=n>logger</span><span class=p>.</span><span class=n>info</span><span class=p>(</span><span class=n>f</span><span class=ss>&quot;Loading personalization model from {self.model_path}&quot;</span><span class=p>)</span>
<span class=w>            </span><span class=n>self</span><span class=p>.</span><span class=n>model</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tf</span><span class=p>.</span><span class=n>keras</span><span class=p>.</span><span class=n>models</span><span class=p>.</span><span class=n>load_model</span><span class=p>(</span><span class=n>self</span><span class=p>.</span><span class=n>model_path</span><span class=p>)</span>
<span class=w>        </span><span class=k>else</span><span class=err>:</span>
<span class=w>            </span><span class=n>logger</span><span class=p>.</span><span class=n>info</span><span class=p>(</span><span class=ss>&quot;Creating new personalization model&quot;</span><span class=p>)</span>
<span class=w>            </span><span class=n>self</span><span class=p>.</span><span class=n>_create_model</span><span class=p>()</span>
<span class=w>    </span><span class=ow>except</span><span class=w> </span><span class=k>Exception</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nl>e</span><span class=p>:</span>
<span class=w>        </span><span class=n>logger</span><span class=p>.</span><span class=n>error</span><span class=p>(</span><span class=n>f</span><span class=ss>&quot;Error loading model: {str(e)}&quot;</span><span class=p>)</span>
<span class=w>        </span><span class=n>self</span><span class=p>.</span><span class=n>_create_model</span><span class=p>()</span>

<span class=n>def</span><span class=w> </span><span class=n>_create_model</span><span class=p>(</span><span class=n>self</span><span class=p>)</span><span class=err>:</span>
<span class=w>    </span><span class=ss>&quot;&quot;&quot;Create a new TensorFlow model for personalization.&quot;&quot;&quot;</span>
<span class=w>    </span><span class=err>#</span><span class=w> </span><span class=k>Create</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>neural</span><span class=w> </span><span class=n>network</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=n>preference</span><span class=w> </span><span class=n>prediction</span>
<span class=w>    </span><span class=n>self</span><span class=p>.</span><span class=n>model</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tf</span><span class=p>.</span><span class=n>keras</span><span class=p>.</span><span class=n>Sequential</span><span class=p>(</span><span class=o>[</span>
<span class=n>        tf.keras.layers.Input(shape=(10,)),  # 10 features</span>
<span class=n>        tf.keras.layers.Dense(64, activation=&#39;relu&#39;),</span>
<span class=n>        tf.keras.layers.BatchNormalization(),</span>
<span class=n>        tf.keras.layers.Dropout(0.2),</span>
<span class=n>        tf.keras.layers.Dense(32, activation=&#39;relu&#39;),</span>
<span class=n>        tf.keras.layers.BatchNormalization(),</span>
<span class=n>        tf.keras.layers.Dropout(0.2),</span>
<span class=n>        tf.keras.layers.Dense(16, activation=&#39;relu&#39;),</span>
<span class=n>        tf.keras.layers.Dense(4, activation=&#39;softmax&#39;)  # 4 personalization categories</span>
<span class=n>    </span><span class=o>]</span><span class=p>)</span>

<span class=w>    </span><span class=err>#</span><span class=w> </span><span class=n>Compile</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>model</span>
<span class=w>    </span><span class=n>self</span><span class=p>.</span><span class=n>model</span><span class=p>.</span><span class=n>compile</span><span class=p>(</span>
<span class=w>        </span><span class=n>optimizer</span><span class=o>=</span><span class=s1>&#39;adam&#39;</span><span class=p>,</span>
<span class=w>        </span><span class=n>loss</span><span class=o>=</span><span class=s1>&#39;sparse_categorical_crossentropy&#39;</span><span class=p>,</span>
<span class=w>        </span><span class=n>metrics</span><span class=o>=[</span><span class=n>&#39;accuracy&#39;</span><span class=o>]</span>
<span class=w>    </span><span class=p>)</span>

<span class=w>    </span><span class=err>#</span><span class=w> </span><span class=k>Initialize</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=ow>some</span><span class=w> </span><span class=n>random</span><span class=w> </span><span class=n>weights</span>
<span class=w>    </span><span class=err>#</span><span class=w> </span><span class=ow>In</span><span class=w> </span><span class=n>production</span><span class=p>,</span><span class=w> </span><span class=n>you</span><span class=w> </span><span class=n>would</span><span class=w> </span><span class=n>train</span><span class=w> </span><span class=n>this</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=nc>real</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>data</span>
<span class=w>    </span><span class=n>dummy_x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>np</span><span class=p>.</span><span class=n>random</span><span class=p>.</span><span class=n>random</span><span class=p>((</span><span class=mi>100</span><span class=p>,</span><span class=w> </span><span class=mi>10</span><span class=p>))</span>
<span class=w>    </span><span class=n>dummy_y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>np</span><span class=p>.</span><span class=n>random</span><span class=p>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=k>size</span><span class=o>=</span><span class=p>(</span><span class=mi>100</span><span class=p>,))</span>
<span class=w>    </span><span class=n>self</span><span class=p>.</span><span class=n>model</span><span class=p>.</span><span class=n>fit</span><span class=p>(</span><span class=n>dummy_x</span><span class=p>,</span><span class=w> </span><span class=n>dummy_y</span><span class=p>,</span><span class=w> </span><span class=n>epochs</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span><span class=w> </span><span class=n>verbose</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>

<span class=w>    </span><span class=err>#</span><span class=w> </span><span class=k>Save</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>model</span>
<span class=w>    </span><span class=n>os</span><span class=p>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>os</span><span class=p>.</span><span class=k>path</span><span class=p>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>self</span><span class=p>.</span><span class=n>model_path</span><span class=p>),</span><span class=w> </span><span class=n>exist_ok</span><span class=o>=</span><span class=k>True</span><span class=p>)</span>
<span class=w>    </span><span class=n>self</span><span class=p>.</span><span class=n>model</span><span class=p>.</span><span class=k>save</span><span class=p>(</span><span class=n>self</span><span class=p>.</span><span class=n>model_path</span><span class=p>)</span>

<span class=n>def</span><span class=w> </span><span class=n>predict_category</span><span class=p>(</span><span class=n>self</span><span class=p>,</span><span class=w> </span><span class=nl>features</span><span class=p>:</span><span class=w> </span><span class=n>np</span><span class=p>.</span><span class=n>ndarray</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>Dict</span><span class=o>[</span><span class=n>str, Any</span><span class=o>]</span><span class=err>:</span>
<span class=w>    </span><span class=ss>&quot;&quot;&quot;Predict personalization category for user features.&quot;&quot;&quot;</span>
<span class=w>    </span><span class=err>#</span><span class=w> </span><span class=n>Reshape</span><span class=w> </span><span class=n>features</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=k>match</span><span class=w> </span><span class=n>model</span><span class=w> </span><span class=k>input</span><span class=w> </span><span class=n>shape</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>features</span><span class=p>.</span><span class=n>ndim</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>1</span><span class=err>:</span>
<span class=w>        </span><span class=n>features</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>features</span><span class=p>.</span><span class=n>reshape</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>

<span class=w>    </span><span class=err>#</span><span class=w> </span><span class=k>Get</span><span class=w> </span><span class=n>predictions</span>
<span class=w>    </span><span class=n>predictions</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>self</span><span class=p>.</span><span class=n>model</span><span class=p>.</span><span class=n>predict</span><span class=p>(</span><span class=n>features</span><span class=p>)</span>
<span class=w>    </span><span class=n>category_index</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>np</span><span class=p>.</span><span class=n>argmax</span><span class=p>(</span><span class=n>predictions</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>)</span>
<span class=w>    </span><span class=n>confidence</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nc>float</span><span class=p>(</span><span class=n>predictions</span><span class=o>[</span><span class=n>0</span><span class=o>][</span><span class=n>category_index</span><span class=o>]</span><span class=p>)</span>

<span class=w>    </span><span class=err>#</span><span class=w> </span><span class=k>Map</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=n>category</span><span class=w> </span><span class=k>names</span>
<span class=w>    </span><span class=n>categories</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>[</span><span class=n>&quot;informational&quot;, &quot;promotional&quot;, &quot;relationship&quot;, &quot;transactional&quot;</span><span class=o>]</span>
<span class=w>    </span><span class=n>category</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>categories</span><span class=o>[</span><span class=n>category_index</span><span class=o>]</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=err>{</span>
<span class=w>        </span><span class=ss>&quot;category&quot;</span><span class=err>:</span><span class=w> </span><span class=n>category</span><span class=p>,</span>
<span class=w>        </span><span class=ss>&quot;confidence&quot;</span><span class=err>:</span><span class=w> </span><span class=n>confidence</span><span class=p>,</span>
<span class=w>        </span><span class=ss>&quot;all_probabilities&quot;</span><span class=err>:</span><span class=w> </span><span class=err>{</span><span class=nl>cat</span><span class=p>:</span><span class=w> </span><span class=nc>float</span><span class=p>(</span><span class=n>prob</span><span class=p>)</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>cat</span><span class=p>,</span><span class=w> </span><span class=n>prob</span><span class=w> </span><span class=ow>in</span><span class=w> </span><span class=n>zip</span><span class=p>(</span><span class=n>categories</span><span class=p>,</span><span class=w> </span><span class=n>predictions</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>)</span><span class=err>}</span>
<span class=w>    </span><span class=err>}</span>

<span class=n>def</span><span class=w> </span><span class=n>train</span><span class=p>(</span><span class=n>self</span><span class=p>,</span><span class=w> </span><span class=nl>features</span><span class=p>:</span><span class=w> </span><span class=n>np</span><span class=p>.</span><span class=n>ndarray</span><span class=p>,</span><span class=w> </span><span class=nl>categories</span><span class=p>:</span><span class=w> </span><span class=n>np</span><span class=p>.</span><span class=n>ndarray</span><span class=p>,</span><span class=w> </span><span class=nl>epochs</span><span class=p>:</span><span class=w> </span><span class=nc>int</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=p>)</span><span class=err>:</span>
<span class=w>    </span><span class=ss>&quot;&quot;&quot;Train the model with new data.&quot;&quot;&quot;</span>
<span class=w>    </span><span class=n>history</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>self</span><span class=p>.</span><span class=n>model</span><span class=p>.</span><span class=n>fit</span><span class=p>(</span><span class=n>features</span><span class=p>,</span><span class=w> </span><span class=n>categories</span><span class=p>,</span><span class=w> </span><span class=n>epochs</span><span class=o>=</span><span class=n>epochs</span><span class=p>,</span><span class=w> </span><span class=n>verbose</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>

<span class=w>    </span><span class=err>#</span><span class=w> </span><span class=k>Save</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>updated</span><span class=w> </span><span class=n>model</span>
<span class=w>    </span><span class=n>self</span><span class=p>.</span><span class=n>model</span><span class=p>.</span><span class=k>save</span><span class=p>(</span><span class=n>self</span><span class=p>.</span><span class=n>model_path</span><span class=p>)</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=err>{</span>
<span class=w>        </span><span class=ss>&quot;loss&quot;</span><span class=err>:</span><span class=w> </span><span class=nc>float</span><span class=p>(</span><span class=n>history</span><span class=p>.</span><span class=n>history</span><span class=o>[</span><span class=n>&#39;loss&#39;</span><span class=o>][</span><span class=n>-1</span><span class=o>]</span><span class=p>),</span>
<span class=w>        </span><span class=ss>&quot;accuracy&quot;</span><span class=err>:</span><span class=w> </span><span class=nc>float</span><span class=p>(</span><span class=n>history</span><span class=p>.</span><span class=n>history</span><span class=o>[</span><span class=n>&#39;accuracy&#39;</span><span class=o>][</span><span class=n>-1</span><span class=o>]</span><span class=p>)</span>
<span class=w>    </span><span class=err>}</span>
</code></pre></div> <p>class PersonalizationStrategy: """Personalization strategy factory."""</p> <div class=codehilite><pre><span></span><code><span class=err>@</span><span class=n>staticmethod</span>
<span class=n>def</span><span class=w> </span><span class=n>get_strategy</span><span class=p>(</span><span class=n>category</span><span class=p>:</span><span class=w> </span><span class=nb>str</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span><span class=w> </span><span class=n>Any</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Get personalization strategy for a category.&quot;&quot;&quot;</span>
<span class=w>    </span><span class=n>strategies</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=s2>&quot;informational&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=s2>&quot;content_style&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;educational and fact-based&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;subject_style&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;clear and specific&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;cta_style&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;learn more or download resources&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;frequency&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;weekly&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;best_time&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;morning&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;image_ratio&quot;</span><span class=p>:</span><span class=w> </span><span class=mf>0.3</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;email_length&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;medium&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;tone&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;professional&quot;</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=s2>&quot;promotional&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=s2>&quot;content_style&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;benefit-oriented with offers&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;subject_style&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;attention-grabbing with urgency&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;cta_style&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;act now, limited time offers&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;frequency&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;twice weekly&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;best_time&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;lunch or evening&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;image_ratio&quot;</span><span class=p>:</span><span class=w> </span><span class=mf>0.6</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;email_length&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;short to medium&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;tone&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;enthusiastic&quot;</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=s2>&quot;relationship&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=s2>&quot;content_style&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;personal and conversational&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;subject_style&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;friendly and informal&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;cta_style&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;soft engagement, feedback requests&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;frequency&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;bi-weekly&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;best_time&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;evening&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;image_ratio&quot;</span><span class=p>:</span><span class=w> </span><span class=mf>0.4</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;email_length&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;medium to long&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;tone&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;warm&quot;</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=s2>&quot;transactional&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=s2>&quot;content_style&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;direct and action-oriented&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;subject_style&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;straightforward with clear purpose&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;cta_style&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;complete transaction or next steps&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;frequency&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;as needed&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;best_time&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;business hours&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;image_ratio&quot;</span><span class=p>:</span><span class=w> </span><span class=mf>0.2</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;email_length&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;short&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;tone&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;direct&quot;</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>strategies</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>category</span><span class=p>,</span><span class=w> </span><span class=n>strategies</span><span class=p>[</span><span class=s2>&quot;informational&quot;</span><span class=p>])</span>
</code></pre></div> <p>class UserFeatureExtractor: """Extract user features for personalization."""</p> <div class=codehilite><pre><span></span><code><span class=nv>@staticmethod</span>
<span class=n>def</span><span class=w> </span><span class=n>extract_features</span><span class=p>(</span><span class=nl>user_data</span><span class=p>:</span><span class=w> </span><span class=n>Dict</span><span class=o>[</span><span class=n>str, Any</span><span class=o>]</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>np</span><span class=p>.</span><span class=nl>ndarray</span><span class=p>:</span>
<span class=w>    </span><span class=ss>&quot;&quot;&quot;Extract features from user data.&quot;&quot;&quot;</span>
<span class=w>    </span><span class=n>features</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>np</span><span class=p>.</span><span class=n>zeros</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>

<span class=w>    </span><span class=err>#</span><span class=w> </span><span class=mf>1.</span><span class=w> </span><span class=n>Average</span><span class=w> </span><span class=k>open</span><span class=w> </span><span class=n>rate</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
<span class=w>    </span><span class=n>features</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>user_data</span><span class=p>.</span><span class=k>get</span><span class=p>(</span><span class=ss>&quot;avg_open_rate&quot;</span><span class=p>,</span><span class=w> </span><span class=mf>0.0</span><span class=p>)</span>

<span class=w>    </span><span class=err>#</span><span class=w> </span><span class=mf>2.</span><span class=w> </span><span class=n>Average</span><span class=w> </span><span class=n>click</span><span class=w> </span><span class=n>rate</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
<span class=w>    </span><span class=n>features</span><span class=o>[</span><span class=n>1</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>user_data</span><span class=p>.</span><span class=k>get</span><span class=p>(</span><span class=ss>&quot;avg_click_rate&quot;</span><span class=p>,</span><span class=w> </span><span class=mf>0.0</span><span class=p>)</span>

<span class=w>    </span><span class=err>#</span><span class=w> </span><span class=mf>3.</span><span class=w> </span><span class=n>Conversion</span><span class=w> </span><span class=n>rate</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
<span class=w>    </span><span class=n>features</span><span class=o>[</span><span class=n>2</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>user_data</span><span class=p>.</span><span class=k>get</span><span class=p>(</span><span class=ss>&quot;conversion_rate&quot;</span><span class=p>,</span><span class=w> </span><span class=mf>0.0</span><span class=p>)</span>

<span class=w>    </span><span class=err>#</span><span class=w> </span><span class=mf>4.</span><span class=w> </span><span class=n>Email</span><span class=w> </span><span class=n>frequency</span><span class=w> </span><span class=n>preference</span><span class=w> </span><span class=p>(</span><span class=n>normalized</span><span class=w> </span><span class=mi>0</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
<span class=w>    </span><span class=n>features</span><span class=o>[</span><span class=n>3</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>min</span><span class=p>(</span><span class=n>user_data</span><span class=p>.</span><span class=k>get</span><span class=p>(</span><span class=ss>&quot;email_frequency&quot;</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>7</span><span class=p>,</span><span class=w> </span><span class=mf>1.0</span><span class=p>)</span>

<span class=w>    </span><span class=err>#</span><span class=w> </span><span class=mf>5.</span><span class=w> </span><span class=n>Days</span><span class=w> </span><span class=n>since</span><span class=w> </span><span class=k>last</span><span class=w> </span><span class=k>open</span><span class=w> </span><span class=p>(</span><span class=n>normalized</span><span class=w> </span><span class=mi>0</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
<span class=w>    </span><span class=n>days_since_open</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>user_data</span><span class=p>.</span><span class=k>get</span><span class=p>(</span><span class=ss>&quot;days_since_open&quot;</span><span class=p>,</span><span class=w> </span><span class=mi>30</span><span class=p>)</span>
<span class=w>    </span><span class=n>features</span><span class=o>[</span><span class=n>4</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>1.0</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nf>min</span><span class=p>(</span><span class=n>days_since_open</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>30</span><span class=p>,</span><span class=w> </span><span class=mf>1.0</span><span class=p>)</span><span class=w>  </span><span class=err>#</span><span class=w> </span><span class=n>Invert</span><span class=w> </span><span class=n>so</span><span class=w> </span><span class=n>higher</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=n>better</span>

<span class=w>    </span><span class=err>#</span><span class=w> </span><span class=mf>6.</span><span class=w> </span><span class=n>Device</span><span class=w> </span><span class=n>preference</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=o>=</span><span class=n>desktop</span><span class=p>,</span><span class=w> </span><span class=mf>0.5</span><span class=o>=</span><span class=n>mixed</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=o>=</span><span class=n>mobile</span><span class=p>)</span>
<span class=w>    </span><span class=n>features</span><span class=o>[</span><span class=n>5</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>user_data</span><span class=p>.</span><span class=k>get</span><span class=p>(</span><span class=ss>&quot;device_preference&quot;</span><span class=p>,</span><span class=w> </span><span class=mf>0.5</span><span class=p>)</span>

<span class=w>    </span><span class=err>#</span><span class=w> </span><span class=mf>7.</span><span class=w> </span><span class=n>Content</span><span class=w> </span><span class=n>preference</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=o>=</span><span class=nc>text</span><span class=p>,</span><span class=w> </span><span class=mf>0.5</span><span class=o>=</span><span class=n>mixed</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=o>=</span><span class=nc>image</span><span class=p>)</span>
<span class=w>    </span><span class=n>features</span><span class=o>[</span><span class=n>6</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>user_data</span><span class=p>.</span><span class=k>get</span><span class=p>(</span><span class=ss>&quot;content_preference&quot;</span><span class=p>,</span><span class=w> </span><span class=mf>0.5</span><span class=p>)</span>

<span class=w>    </span><span class=err>#</span><span class=w> </span><span class=mf>8.</span><span class=w> </span><span class=n>Engagement</span><span class=w> </span><span class=nc>time</span><span class=w> </span><span class=n>preference</span><span class=w> </span><span class=p>(</span><span class=n>normalized</span><span class=w> </span><span class=mi>0</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=o>=</span><span class=n>morning</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=o>=</span><span class=n>night</span><span class=p>)</span>
<span class=w>    </span><span class=n>features</span><span class=o>[</span><span class=n>7</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>user_data</span><span class=p>.</span><span class=k>get</span><span class=p>(</span><span class=ss>&quot;engagement_time&quot;</span><span class=p>,</span><span class=w> </span><span class=mf>0.5</span><span class=p>)</span>

<span class=w>    </span><span class=err>#</span><span class=w> </span><span class=mf>9.</span><span class=w> </span><span class=n>Response</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=n>promotions</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
<span class=w>    </span><span class=n>features</span><span class=o>[</span><span class=n>8</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>user_data</span><span class=p>.</span><span class=k>get</span><span class=p>(</span><span class=ss>&quot;promotion_response&quot;</span><span class=p>,</span><span class=w> </span><span class=mf>0.0</span><span class=p>)</span>

<span class=w>    </span><span class=err>#</span><span class=w> </span><span class=mf>10.</span><span class=w> </span><span class=n>Unsubscribe</span><span class=w> </span><span class=n>risk</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=nf>lower</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=n>better</span><span class=p>)</span>
<span class=w>    </span><span class=n>features</span><span class=o>[</span><span class=n>9</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>1.0</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>user_data</span><span class=p>.</span><span class=k>get</span><span class=p>(</span><span class=ss>&quot;unsubscribe_risk&quot;</span><span class=p>,</span><span class=w> </span><span class=mf>0.0</span><span class=p>)</span><span class=w>  </span><span class=err>#</span><span class=w> </span><span class=n>Invert</span><span class=w> </span><span class=n>so</span><span class=w> </span><span class=n>higher</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=n>better</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>features</span>
</code></pre></div> <p>class TrustScoreCalculator: """Calculate trust scores for campaigns and users."""</p> <div class=codehilite><pre><span></span><code><span class=nv>@staticmethod</span>
<span class=n>def</span><span class=w> </span><span class=n>calculate_campaign_trust_score</span><span class=p>(</span><span class=nl>user_profile</span><span class=p>:</span><span class=w> </span><span class=n>Dict</span><span class=o>[</span><span class=n>str, Any</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=nl>campaign_data</span><span class=p>:</span><span class=w> </span><span class=n>Dict</span><span class=o>[</span><span class=n>str, Any</span><span class=o>]</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=nc>int</span><span class=err>:</span>
<span class=w>    </span><span class=ss>&quot;&quot;&quot;Calculate trust score for a specific campaign.&quot;&quot;&quot;</span>
<span class=w>    </span><span class=err>#</span><span class=w> </span><span class=n>Base</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=n>starts</span><span class=w> </span><span class=k>at</span><span class=w> </span><span class=mi>50</span>
<span class=w>    </span><span class=n>score</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>50</span>
</code></pre></div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024-2025 Maily Team </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/yourusername/maily target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://twitter.com/mailyapp target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.f1b6f286.min.js></script> </body> </html>
